var VROne={};"undefined"!=typeof module&&(module.exports=VROne),"undefined"==typeof navigator&&(navigator={}),VROne.requestAnimFrame=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};t.call(window,e)},VROne.Vector2=function(e,t){this.x=e||0,this.y=t||0},VROne.Vector2.prototype={getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);return 0!==e&&(this.x/=e,this.y/=e),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},nullVector:function(){return this.x=0,this.y=0,this},scaleBy:function(e){return this.x*=e,this.y*=e,this},set:function(e,t){return this.x=e,this.y=t,this},add:function(e,t){return this.x+=e,this.y+=t,this},subtract:function(e,t){return this.x-=e,this.y-=t,this},multiply:function(e,t){return this.x*=e,this.y*=t,this},distance:function(e,t){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},dotProduct:function(e){return this.x*e.x+this.y*e.y},addVector2:function(e){return this.x+=e.x,this.y+=e.y,this},copyToVector:function(e,t){t.x=e.x,t.y=e.y},copy:function(){return new VROne.Vector2(this.x,this.y)}},VROne.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},VROne.Vector3.prototype={getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return 0!==e&&(this.x/=e,this.y/=e,this.z/=e),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},nullVector:function(){return this.x=0,this.y=0,this.z=0,this},scaleBy:function(e){return this.x*=e,this.y*=e,this.z*=e,this},set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},add:function(e,t,i){return this.x+=e,this.y+=t,this.z+=i,this},subtract:function(e,t,i){return this.x-=e,this.y-=t,this.z-=i,this},multiply:function(e,t,i){return this.x*=e,this.y*=t,this.z*=i,this},distance:function(e,t){var i=t.x-e.x,r=t.y-e.y,n=t.z-e.z;return Math.sqrt(i*i+r*r+n*n)},dotProduct:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},crossProduct:function(e){return new VROne.Vector3(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},addVector3:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},copyToVector:function(e,t){t.x=e.x,t.y=e.y,t.z=e.z},copy:function(){return new VROne.Vector3(this.x,this.y,this.z)}},VROne.Quaternion=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=r||1},VROne.Quaternion.prototype={multiply:function(e,t){var i=e.w,r=e.x,n=e.y,o=e.z,a=t.w,s=t.x,h=t.y,l=t.z;return this.w=i*a-r*s-n*h-o*l,this.x=i*s+r*a+n*l-o*h,this.y=i*h-r*l+n*a+o*s,this.z=i*l+r*h-n*s+o*a,this},set:function(e,t,i,r){this.x=e,this.y=t,this.z=i,this.w=r},fromAxisAngle:function(e,t){e.normalize();var i=Math.sin(t/2),r=Math.cos(t/2);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=r,this.normalize(),this},fromEulerAngles:function(e,t,i){var r=.5*e,n=.5*t,o=.5*i,a=Math.cos(r),s=Math.sin(r),h=Math.cos(n),l=Math.sin(n),u=Math.cos(o),c=Math.sin(o);return this.w=a*h*u+s*l*c,this.x=s*h*u-a*l*c,this.y=a*l*u+s*h*c,this.z=a*h*c-s*l*u,this},normalize:function(){var e=this.x,t=this.y,i=this.z,r=this.w,n=1/Math.sqrt(e*e+t*t+i*i+r*r);return this.x*=n,this.y*=n,this.z*=n,this.w*=n,this},reset:function(){this.x=0,this.y=0,this.z=0,this.w=1},rotatePoint:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.x,a=e.y,s=e.z,h=-t*o-i*a-r*s,l=n*o+i*s-r*a,u=n*a-t*s+r*o,c=n*s+t*a-i*o;return e.x=-h*t+l*n-u*r+c*i,e.y=-h*i+l*r+u*n-c*t,e.z=-h*r-l*i+u*t+c*n,e},getRotatedPoint:function(e,t){var i,r,n,o,a=this.x,s=this.y,h=this.z,l=this.w,u=e.x,c=e.y,d=e.z;o=-a*u-s*c-h*d,i=l*u+s*d-h*c,r=l*c-a*d+h*u,n=l*d+a*c-s*u;var p=t?t:new VROne.Vector3;return p.x=-o*a+i*l-r*h+n*s,p.y=-o*s+i*h+r*l-n*a,p.z=-o*h-i*s+r*a+n*l,p},toRotationMatrix:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=t*t,a=t*i,s=t*r,h=t*n,l=i*i,u=i*r,c=i*n,d=r*r,p=r*n;e.data[0]=1-2*(l+d),e.data[1]=2*(a-p),e.data[2]=2*(s+c),e.data[4]=2*(a+p),e.data[5]=1-2*(o+d),e.data[6]=2*(u-h),e.data[8]=2*(s-c),e.data[9]=2*(u+h),e.data[10]=1-2*(o+l),e.data[3]=e.data[7]=e.data[11]=e.data[12]=e.data[13]=e.data[14]=0,e.data[15]=1},getConjugate:function(e){return this.normalize(),e?(e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e):new VROne.Quaternion(-this.x,-this.y,-this.z,this.w)},copy:function(){return new VROne.Quaternion(this.x,this.y,this.z,this.w)},copyToQuaternion:function(e,t){t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w},slerp:function(e,t,i){var r=e.w,n=e.x,o=e.y,a=e.z,s=t.w,h=t.x,l=t.y,u=t.z,c=r*s+n*h+o*l+a*u;if(0>c&&(c=-c,s=-s,h=-h,l=-l,u=-u),.95>c){var d=Math.acos(c),p=1/Math.sin(d),f=Math.sin(d*(1-i))*p,g=Math.sin(d*i)*p;this.w=r*f+s*g,this.x=n*f+h*g,this.y=o*f+l*g,this.z=a*f+u*g}else{this.w=r+i*(s-r),this.x=n+i*(h-n),this.y=o+i*(l-o),this.z=a+i*(u-a);var x=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.w*=x,this.x*=x,this.y*=x,this.z*=x}},getForwardVector:function(){return new VROne.Vector3(2*(this.x*this.z+this.w*this.y),2*(this.y*this.x-this.w*this.x),1-2*(this.x*this.x+this.y*this.y))},getUpVector:function(){return new VROne.Vector3(2*(this.x*this.y-this.w*this.z),1-2*(this.x*this.x+this.z*this.z),2*(this.y*this.z+this.w*this.x))},getRightVector:function(){return new VROne.Vector3(1-2*(this.y*this.y+this.z*this.z),2*(this.x*this.y+this.w*this.z),2*(this.x*this.z-this.w*this.y))}},VROne.Matrix4=function(){this.data=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},VROne.Matrix4.makePerspective=function(e,t,i,r){var n=new VROne.Matrix4,o=e/2*Math.PI/180,a=Math.sin(o),s=Math.cos(o)/a,h=!0,l=h?-1:1;return n.data=new Float32Array([s/t,0,0,0,0,s,0,0,0,0,r/(i-r)*-l,l,0,0,r*i/(i-r),0]),n},VROne.Matrix4.makeOrthoPerspective=function(e,t,i,r,n,o){var a=new VROne.Matrix4,s=1/(e-t),h=1/(r-i),l=1/(n-o);return a.data=new Float32Array([-2*s,0,0,0,0,-2*h,0,0,0,0,2*l,0,(e+t)*s,(i+r)*h,(o+n)*l,1]),a},VROne.Matrix4.makeVRPerspective=function(e,t,i){var r=Math.PI/180,n=Math.tan(e.upDegrees*r),o=Math.tan(e.downDegrees*r),a=Math.tan(e.leftDegrees*r),s=Math.tan(e.rightDegrees*r),h=2/(a+s),l=(a-s)*h*.5,u=2/(n+o),c=(n-o)*u*.5,d=!0,p=d?-1:1,f=new VROne.Matrix4;return f.data=new Float32Array([h,0,0,0,0,u,0,0,l*p,c*p,i/(t-i)*-p,p,0,0,i*t/(t-i),0]),f},VROne.Matrix4.prototype={poolMatrix:new VROne.Matrix4,poolVector3:new VROne.Vector3,identity:function(){this.data[0]=1,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=0,this.data[5]=1,this.data[6]=0,this.data[7]=0,this.data[8]=0,this.data[9]=0,this.data[10]=1,this.data[11]=0,this.data[12]=0,this.data[13]=0,this.data[14]=0,this.data[15]=1},apply:function(e){var t=this.data[0],i=this.data[4],r=this.data[8],n=this.data[12],o=this.data[1],a=this.data[5],s=this.data[9],h=this.data[13],l=this.data[2],u=this.data[6],c=this.data[10],d=this.data[14],p=this.data[3],f=this.data[7],g=this.data[11],x=this.data[15],m=e.data[0],v=e.data[4],y=e.data[8],R=e.data[12],V=e.data[1],O=e.data[5],w=e.data[9],M=e.data[13],b=e.data[2],S=e.data[6],C=e.data[10],T=e.data[14],A=e.data[3],z=e.data[7],P=e.data[11],E=e.data[15];this.data[0]=t*m+o*v+l*y+p*R,this.data[1]=t*V+o*O+l*w+p*M,this.data[2]=t*b+o*S+l*C+p*T,this.data[3]=t*A+o*z+l*P+p*E,this.data[4]=i*m+a*v+u*y+f*R,this.data[5]=i*V+a*O+u*w+f*M,this.data[6]=i*b+a*S+u*C+f*T,this.data[7]=i*A+a*z+u*P+f*E,this.data[8]=r*m+s*v+c*y+g*R,this.data[9]=r*V+s*O+c*w+g*M,this.data[10]=r*b+s*S+c*C+g*T,this.data[11]=r*A+s*z+c*P+g*E,this.data[12]=n*m+h*v+d*y+x*R,this.data[13]=n*V+h*O+d*w+x*M,this.data[14]=n*b+h*S+d*C+x*T,this.data[15]=n*A+h*z+d*P+x*E},applyRotation:function(e,t,i){if(this.poolMatrix.data[0]=1,this.poolMatrix.data[1]=0,this.poolMatrix.data[2]=0,this.poolMatrix.data[3]=0,this.poolMatrix.data[4]=0,this.poolMatrix.data[5]=1,this.poolMatrix.data[6]=0,this.poolMatrix.data[7]=0,this.poolMatrix.data[8]=0,this.poolMatrix.data[9]=0,this.poolMatrix.data[10]=1,this.poolMatrix.data[11]=0,this.poolMatrix.data[12]=0,this.poolMatrix.data[13]=0,this.poolMatrix.data[14]=0,this.poolMatrix.data[15]=1,this.getAxisRotation(t.x,t.y,t.z,e,this.poolMatrix),void 0!==i){var r=i;this.poolMatrix.applyTranslation(r.x,r.y,r.z)}this.apply(this.poolMatrix)},applyScale:function(e,t,i){this.poolMatrix.data[0]=e,this.poolMatrix.data[1]=0,this.poolMatrix.data[2]=0,this.poolMatrix.data[3]=0,this.poolMatrix.data[4]=0,this.poolMatrix.data[5]=t,this.poolMatrix.data[6]=0,this.poolMatrix.data[7]=0,this.poolMatrix.data[8]=0,this.poolMatrix.data[9]=0,this.poolMatrix.data[10]=i,this.poolMatrix.data[11]=0,this.poolMatrix.data[12]=0,this.poolMatrix.data[13]=0,this.poolMatrix.data[14]=0,this.poolMatrix.data[15]=1,this.apply(this.poolMatrix)},applyTranslation:function(e,t,i){this.data[12]+=e,this.data[13]+=t,this.data[14]+=i},getAxisRotation:function(e,t,i,r,n){var o;o=n?n:new VROne.Matrix4;var a=this.poolVector3;a.x=e,a.y=t,a.z=i;var s=-r*(Math.PI/180),h=Math.cos(s),l=Math.sin(s),u=1-h;o.data[0]=h+a.x*a.x*u,o.data[5]=h+a.y*a.y*u,o.data[10]=h+a.z*a.z*u;var c=a.x*a.y*u,d=a.z*l;return o.data[4]=c+d,o.data[1]=c-d,c=a.x*a.z*u,d=a.y*l,o.data[8]=c-d,o.data[2]=c+d,c=a.y*a.z*u,d=a.x*l,o.data[9]=c+d,o.data[6]=c-d,o},getDeterminant:function(){return 1*((this.data[0]*this.data[5]-this.data[4]*this.data[1])*(this.data[10]*this.data[15]-this.data[14]*this.data[11])-(this.data[0]*this.data[9]-this.data[8]*this.data[1])*(this.data[6]*this.data[15]-this.data[14]*this.data[7])+(this.data[0]*this.data[13]-this.data[12]*this.data[1])*(this.data[6]*this.data[11]-this.data[10]*this.data[7])+(this.data[4]*this.data[9]-this.data[8]*this.data[5])*(this.data[2]*this.data[15]-this.data[14]*this.data[3])-(this.data[4]*this.data[13]-this.data[12]*this.data[5])*(this.data[2]*this.data[11]-this.data[10]*this.data[3])+(this.data[8]*this.data[13]-this.data[12]*this.data[9])*(this.data[2]*this.data[7]-this.data[6]*this.data[3]))},transpose:function(){this.copyToMatrix(this,this.poolMatrix),this.data[1]=this.poolMatrix.data[4],this.data[2]=this.poolMatrix.data[8],this.data[3]=this.poolMatrix.data[12],this.data[4]=this.poolMatrix.data[1],this.data[6]=this.poolMatrix.data[9],this.data[7]=this.poolMatrix.data[13],this.data[8]=this.poolMatrix.data[2],this.data[9]=this.poolMatrix.data[6],this.data[11]=this.poolMatrix.data[14],this.data[12]=this.poolMatrix.data[3],this.data[13]=this.poolMatrix.data[7],this.data[14]=this.poolMatrix.data[11]},invert:function(){var e=this.getDeterminant(),t=Math.abs(e)>1e-11;if(!t)throw"Can't invert Matrix";e=1/e;var i=this.data[0],r=this.data[4],n=this.data[8],o=this.data[12],a=this.data[1],s=this.data[5],h=this.data[9],l=this.data[13],u=this.data[2],c=this.data[6],d=this.data[10],p=this.data[14],f=this.data[3],g=this.data[7],x=this.data[11],m=this.data[15];return this.data[0]=e*(s*(d*m-p*x)-h*(c*m-p*g)+l*(c*x-d*g)),this.data[1]=-e*(a*(d*m-p*x)-h*(u*m-p*f)+l*(u*x-d*f)),this.data[2]=e*(a*(c*m-p*g)-s*(u*m-p*f)+l*(u*g-c*f)),this.data[3]=-e*(a*(c*x-d*g)-s*(u*x-d*f)+h*(u*g-c*f)),this.data[4]=-e*(r*(d*m-p*x)-n*(c*m-p*g)+o*(c*x-d*g)),this.data[5]=e*(i*(d*m-p*x)-n*(u*m-p*f)+o*(u*x-d*f)),this.data[6]=-e*(i*(c*m-p*g)-r*(u*m-p*f)+o*(u*g-c*f)),this.data[7]=e*(i*(c*x-d*g)-r*(u*x-d*f)+n*(u*g-c*f)),this.data[8]=e*(r*(h*m-l*x)-n*(s*m-l*g)+o*(s*x-h*g)),this.data[9]=-e*(i*(h*m-l*x)-n*(a*m-l*f)+o*(a*x-h*f)),this.data[10]=e*(i*(s*m-l*g)-r*(a*m-l*f)+o*(a*g-s*f)),this.data[11]=-e*(i*(s*x-h*g)-r*(a*x-h*f)+n*(a*g-s*f)),this.data[12]=-e*(r*(h*p-l*d)-n*(s*p-l*c)+o*(s*d-h*c)),this.data[13]=e*(i*(h*p-l*d)-n*(a*p-l*u)+o*(a*d-h*u)),this.data[14]=-e*(i*(s*p-l*c)-r*(a*p-l*u)+o*(a*c-s*u)),this.data[15]=e*(i*(s*d-h*c)-r*(a*d-h*u)+n*(a*c-s*u)),t},transformVector:function(e){var t=e.x,i=e.y,r=e.z;return e.x=t*this.data[0]+i*this.data[4]+r*this.data[8]+this.data[12],e.y=t*this.data[1]+i*this.data[5]+r*this.data[9]+this.data[13],e.z=t*this.data[2]+i*this.data[6]+r*this.data[10]+this.data[14],e},copyToMatrix:function(e,t){t.data[0]=e.data[0],t.data[1]=e.data[1],t.data[2]=e.data[2],t.data[3]=e.data[3],t.data[4]=e.data[4],t.data[5]=e.data[5],t.data[6]=e.data[6],t.data[7]=e.data[7],t.data[8]=e.data[8],t.data[9]=e.data[9],t.data[10]=e.data[10],t.data[11]=e.data[11],t.data[12]=e.data[12],t.data[13]=e.data[13],t.data[14]=e.data[14],t.data[15]=e.data[15]},copy:function(){var e=new VROne.Matrix4;return e.data=new Float32Array(this.data),e},getMatrix3:function(e){var t;return t=e?e:new VROne.Matrix3,t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=this.data[2],t.data[3]=this.data[4],t.data[4]=this.data[5],t.data[5]=this.data[6],t.data[6]=this.data[8],t.data[7]=this.data[9],t.data[8]=this.data[10],t}},VROne.Matrix3=function(){this.data=new Float32Array([1,0,0,0,1,0,0,0,1])},VROne.Matrix3.prototype={},VROne.Geometry=function(){this.position=new VROne.Vector3(0,0,0),this.rotation=new VROne.Quaternion,this.scale=new VROne.Vector3(1,1,1),this.offset=new VROne.Vector3(0,0,0)},VROne.Geometry.prototype={},VROne.Geometry.Box=function(e,t,i){VROne.Geometry.call(this),this.a=e||0,this.b=t||0,this.c=i||0},VROne.Geometry.Box.prototype=new VROne.Geometry,VROne.Geometry.Box.prototype.getO3D=function(e){var t=new VROne.Object3D,i=this.offset,r=this.a,n=this.b,o=this.c;return t.vertices=[],t.vertices.push(i.x+0,i.y+0,i.z+0),t.vertices.push(i.x+r,i.y+0,i.z+0),t.vertices.push(i.x+0,i.y+n,i.z+0),t.vertices.push(i.x+r,i.y+n,i.z+0),t.vertices.push(i.x+0,i.y+0,i.z+o),t.vertices.push(i.x+r,i.y+0,i.z+o),t.vertices.push(i.x+0,i.y+n,i.z+o),t.vertices.push(i.x+r,i.y+n,i.z+o),t.normals=[],t.normals.push(-1,-1,-1),t.normals.push(1,-1,-1),t.normals.push(-1,1,-1),t.normals.push(1,1,-1),t.normals.push(-1,-1,1),t.normals.push(1,-1,1),t.normals.push(-1,1,1),t.normals.push(1,1,1),t.indices=[],e?(t.indices.push(0,1),t.indices.push(5,1),t.indices.push(4,0),t.indices.push(4,5),t.indices.push(2,6),t.indices.push(6,7),t.indices.push(7,3),t.indices.push(3,2),t.indices.push(0,2),t.indices.push(4,6),t.indices.push(5,7),t.indices.push(3,1),t.isWireframe=!0):(t.indices.push(2,1,0),t.indices.push(2,3,1),t.indices.push(7,4,5),t.indices.push(7,6,4),t.indices.push(6,0,4),t.indices.push(6,2,0),t.indices.push(3,5,1),t.indices.push(3,7,5),t.indices.push(0,5,4),t.indices.push(0,1,5),t.indices.push(6,3,2),t.indices.push(6,7,3)),t.position=this.position,t.rotation=this.rotation,t.scale=this.scale,t},VROne.Geometry.Box.prototype.containsPoint=function(e){var t=this,i=function(e){var i=t.position.copy().addVector3(e).addVector3(t.offset);return i.multiply(t.scale.x,t.scale.y,t.scale.z),i=t.rotation.getRotatedPoint(i)},r=function(e,t,i,r){t=t.copy().subtract(e.x,e.y,e.z),i=i.copy().subtract(e.x,e.y,e.z);var n=t.copy().crossProduct(i).normalize(),o=r.copy().subtract(e.x,e.y,e.z),a=n.dotProduct(o);return a},n=i(new VROne.Vector3(0,0,0)),o=i(new VROne.Vector3(0,this.b,0)),a=i(new VROne.Vector3(this.a,this.b,0)),s=i(new VROne.Vector3(0,0,this.c)),h=i(new VROne.Vector3(this.a,0,this.c)),l=i(new VROne.Vector3(0,this.b,this.c)),u=i(new VROne.Vector3(this.a,this.b,this.c)),c=r(l,o,u,e),d=r(s,h,n,e),p=r(l,s,n,e),f=r(u,a,h,e),g=r(l,u,s,e),x=r(o,n,a,e),s=c>0&&d>0&&p>0&&f>0&&g>0&&x>0;return s},VROne.Geometry.Sphere=function(e){VROne.Geometry.call(this),this.r=e||0},VROne.Geometry.Sphere.prototype=new VROne.Geometry,VROne.Geometry.Sphere.prototype.getO3D=function(e,t,i){this.scale=null;var r,n,o=t||10,a=i||10,s=this.r,h=this.offset,l=new VROne.Object3D;for(l.vertices=[],l.normals=[],l.textureCoords=[],r=0;a>=r;r++){var u=r*Math.PI/a,c=Math.sin(u),d=Math.cos(u);for(n=0;o>=n;n++){var p=2*n*Math.PI/o,f=Math.sin(p),g=Math.cos(p),x=g*c,m=d,v=f*c,y=1-n/o,R=1-r/a;l.normals.push(x,m,v),l.textureCoords.push(y,R),l.vertices.push(s*x+h.x,s*m+h.y,s*v+h.z)}}for(e&&(l.isWireframe=!0),l.indices=[],r=0;a>r;r++)for(n=0;o>n;n++){var V=r*(o+1)+n,O=V+o+1;e?(l.indices.push(O+1,O),l.indices.push(O,V),l.indices.push(V+1,V),l.indices.push(V+1,O+1)):(l.indices.push(V+1,O,V),l.indices.push(V+1,O+1,O))}return l.position=this.position,l.rotation=this.rotation,l},VROne.Geometry.Plane=function(e,t,i,r,n){VROne.Geometry.call(this),this.a=e||0,this.b=t||0,this.xVertices=i||2,this.yVertices=r||2,this.splitSquares=n},VROne.Geometry.Plane.prototype=new VROne.Geometry,VROne.Geometry.Plane.prototype.getO3D=function(){var e=new VROne.Object3D,t=this.offset,i=this.a,r=this.b,n=this.xVertices,o=this.yVertices;e.vertices=[];var a,s,h=i/n,l=r/o;if(this.splitSquares){for(s=0;s<this.yVertices-1;s++)for(a=0;a<this.xVertices-1;a++)e.vertices.push(t.x+a*h,t.y+s*l,t.z,t.x+a*h+h,t.y+s*l,t.z,t.x+a*h,t.y+s*l+l,t.z,t.x+a*h+h,t.y+s*l,t.z,t.x+a*h+h,t.y+s*l+l,t.z,t.x+a*h,t.y+s*l+l,t.z);e.normals=[],e.indices=[];for(var u=0;u<e.vertices.length/3;u++)e.normals.push(0,0,1),e.indices.push(u)}else{for(s=0;s<this.yVertices;s++)for(a=0;a<this.xVertices;a++)e.vertices.push(t.x+a*h,t.y+s*l,t.z);for(e.normals=[],u=0;n*o>u;u++)e.normals.push(0,0,1);for(e.indices=[],u=0;n*(o-1)>u;u++)(u+1)%n!=0&&e.indices.push(u+1,u+n,u,u+n+1,u+n,u+1)}return e.position=this.position,e.rotation=this.rotation,e.scale=this.scale,e},VROne.Geometry.Icosahedron=function(e){this.subdivisions=e,VROne.Geometry.call(this)},VROne.Geometry.Icosahedron.prototype=new VROne.Geometry,VROne.Geometry.Icosahedron.prototype.getO3D=function(){var e=new VROne.Object3D,t=new VROne.Vector2(.5,(1+Math.sqrt(5))/2-(1+Math.sqrt(5))/2/2),i=new VROne.Vector2(-t.x,t.y),r=new VROne.Vector2(t.x,t.y),n=new VROne.Vector2(-t.x,-t.y),o=new VROne.Vector2(t.x,-t.y),a=[];a.push(i.x,i.y,0,r.x,r.y,0,n.x,n.y,0,o.x,o.y,0,0,i.x,i.y,0,r.x,r.y,0,n.x,n.y,0,o.x,o.y,i.y,0,i.x,r.y,0,r.x,n.y,0,n.x,o.y,0,o.x),e.vertices=[a[0],a[1],a[2],a[15],a[16],a[17],a[3],a[4],a[5],a[0],a[1],a[2],a[3],a[4],a[5],a[21],a[22],a[23],a[0],a[1],a[2],a[30],a[31],a[32],a[33],a[34],a[35],a[0],a[1],a[2],a[21],a[22],a[23],a[30],a[31],a[32],a[0],a[1],a[2],a[33],a[34],a[35],a[15],a[16],a[17],a[3],a[4],a[5],a[27],a[28],a[29],a[24],a[25],a[26],a[3],a[4],a[5],a[24],a[25],a[26],a[21],a[22],a[23],a[3],a[4],a[5],a[15],a[16],a[17],a[27],a[28],a[29],a[12],a[13],a[14],a[27],a[28],a[29],a[15],a[16],a[17],a[12],a[13],a[14],a[9],a[10],a[11],a[27],a[28],a[29],a[12],a[13],a[14],a[15],a[16],a[17],a[33],a[34],a[35],a[6],a[7],a[8],a[33],a[34],a[35],a[30],a[31],a[32],a[6],a[7],a[8],a[12],a[13],a[14],a[33],a[34],a[35],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[9],a[10],a[11],a[24],a[25],a[26],a[27],a[28],a[29],a[18],a[19],a[20],a[6],a[7],a[8],a[30],a[31],a[32],a[18],a[19],a[20],a[9],a[10],a[11],a[6],a[7],a[8],a[18],a[19],a[20],a[24],a[25],a[26],a[9],a[10],a[11],a[18],a[19],a[20],a[21],a[22],a[23],a[24],a[25],a[26],a[18],a[19],a[20],a[30],a[31],a[32],a[21],a[22],a[23]];var s=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),h=[e.vertices],l=this.subdivisions-1;i=new VROne.Vector3(0,0,0),r=new VROne.Vector3(0,0,0),n=new VROne.Vector3(0,0,0);for(var u,c=new VROne.Vector3(0,0,0),d=new VROne.Vector3(0,0,0),p=new VROne.Vector3(0,0,0),f=1;l+1>f;f++)h[f]=[];for(f=0;f<h.length-1;f++)for(var g=0;g<h[f].length;g+=9)i.set(h[f][g],h[f][g+1],i.z=h[f][g+2]),r.set(h[f][g+3],h[f][g+4],h[f][g+5]),n.set(h[f][g+6],h[f][g+7],h[f][g+8]),c.set((i.x+r.x)/2,(i.y+r.y)/2,(i.z+r.z)/2),u=s/Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z),c.x*=u,c.y*=u,c.z*=u,d.set((r.x+n.x)/2*u,(r.y+n.y)/2*u,(r.z+n.z)/2*u),p.set((i.x+n.x)/2*u,(i.y+n.y)/2*u,(i.z+n.z)/2*u),h[f+1].push(i.x,i.y,i.z,c.x,c.y,c.z,p.x,p.y,p.z,r.x,r.y,r.z,d.x,d.y,d.z,c.x,c.y,c.z,n.x,n.y,n.z,p.x,p.y,p.z,d.x,d.y,d.z,c.x,c.y,c.z,d.x,d.y,d.z,p.x,p.y,p.z),g==h[f].length-1&&l--;for(e.vertices=h[h.length-1],e.indices=[],f=0;f<e.vertices.length/3;f++)e.indices.push(f);var x;for(e.normals=[],f=0;f<e.vertices.length;f+=9)i.set(e.vertices[f],e.vertices[f+1],e.vertices[f+2]),r.set(e.vertices[f+3],e.vertices[f+4],e.vertices[f+5]),n.set(e.vertices[f+6],e.vertices[f+7],e.vertices[f+8]),c=r.subtract(i.x,i.y,i.z),p=n.subtract(i.x,i.y,i.z),x=c.crossProduct(p),e.normals.push(x.x,x.y,x.z,x.x,x.y,x.z,x.x,x.y,x.z);return e.position=this.position,e.rotation=this.rotation,e.scale=this.scale,e},VROne.Geometry.CollisionMath={},VROne.Geometry.CollisionMath.ObjectPool={corners1:[new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3],corners2:[new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3],normals:[new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3,new VROne.Vector3],edgeNormalV1:new VROne.Vector3,edgeNormalV2:new VROne.Vector3},VROne.Geometry.CollisionMath.calcCorner=function(e,t,i,r,n){e.x=i?t.a:0,e.y=r?t.b:0,e.z=n?t.c:0,e.addVector3(t.offset),e.multiply(t.scale.x,t.scale.y,t.scale.z),t.rotation.getConjugate().rotatePoint(e),e.addVector3(t.position)},VROne.Geometry.CollisionMath.calcNormal=function(e,t,i,r){var n=i.x-t.x,o=i.y-t.y,a=i.z-t.z,s=r.x-t.x,h=r.y-t.y,l=r.z-t.z;e.x=o*l-a*h,e.y=a*s-n*l,e.z=n*h-o*s,e.normalize()},VROne.Geometry.CollisionMath.getEdgeNormal=function(e,t,i,r){var n=VROne.Geometry.CollisionMath.ObjectPool.edgeNormalV1;n.x=i.x-t.x,n.y=i.y-t.y,n.z=i.z-t.z,n.normalize();var o=n.x*(r.x-t.x)+n.y*(r.y-t.y)+n.z*(r.z-t.z);e.x=n.x*o+t.x-r.x,e.y=n.y*o+t.y-r.y,e.z=n.z*o+t.z-r.z,e.normalize()},VROne.Geometry.prototype.boxBoxCollision=function(e,t){var i=VROne.Geometry.CollisionMath.calcCorner,r=VROne.Geometry.CollisionMath.calcNormal,n=VROne.Geometry.CollisionMath.ObjectPool.corners1;i(n[0],e,!1,!1,!1),i(n[1],e,!0,!1,!1),i(n[2],e,!1,!0,!1),i(n[3],e,!0,!0,!1),i(n[4],e,!1,!1,!0),i(n[5],e,!0,!1,!0),i(n[6],e,!1,!0,!0),i(n[7],e,!0,!0,!0);var o=VROne.Geometry.CollisionMath.ObjectPool.corners2;i(o[0],t,!1,!1,!1),i(o[1],t,!0,!1,!1),i(o[2],t,!1,!0,!1),i(o[3],t,!0,!0,!1),i(o[4],t,!1,!1,!0),i(o[5],t,!0,!1,!0),i(o[6],t,!1,!0,!0),i(o[7],t,!0,!0,!0);var a=VROne.Geometry.CollisionMath.ObjectPool.normals,s=6;r(a[0],n[0],n[1],n[2]),r(a[1],n[0],n[4],n[2]),r(a[2],n[0],n[1],n[4]),r(a[3],o[0],o[1],o[2]),r(a[4],o[0],o[4],o[2]),r(a[5],o[0],o[1],o[4]);var h,l,u=null;for(h=0;s>h;h++){var c=a[h];if(0!==c.x||0!==c.y||0!==c.z){var d=null,p=null;for(l=0;l<n.length;l++){var f=c.dotProduct(n[l]);(null===d||d>f)&&(d=f),(null===p||f>p)&&(p=f)}var g=null,x=null;for(l=0;l<o.length;l++){var f=c.dotProduct(o[l]);(null===g||g>f)&&(g=f),(null===x||f>x)&&(x=f)}if(g>p||d>x)return null;var m=p-g;Math.abs(x-d)<Math.abs(m)&&(m=x-d),Math.abs(d-x)<Math.abs(m)&&(m=d-x),Math.abs(g-p)<Math.abs(m)&&(m=g-p),d>g&&(m=-m);var v=c.copy().scaleBy(m);(null===u||u.getLength()>v.getLength())&&(u=v,u.normal=c,u.distance=m)}}return u},VROne.Geometry.prototype.boxSphereCollision=function(e,t,i){(0===e.a||0===e.b||0===e.c)&&(i=!0);var r=VROne.Geometry.CollisionMath.calcCorner,n=VROne.Geometry.CollisionMath.calcNormal,o=VROne.Geometry.CollisionMath.getEdgeNormal,a=VROne.Geometry.CollisionMath.ObjectPool.corners1;r(a[0],e,!1,!1,!1),r(a[1],e,!0,!1,!1),r(a[2],e,!1,!0,!1),r(a[3],e,!0,!0,!1),r(a[4],e,!1,!1,!0),r(a[5],e,!0,!1,!0),r(a[6],e,!1,!0,!0),r(a[7],e,!0,!0,!0);var s=t.position.copy().addVector3(t.offset),h=VROne.Geometry.CollisionMath.ObjectPool.normals,l=15;n(h[0],a[0],a[1],a[2]),n(h[1],a[0],a[2],a[4]),n(h[2],a[0],a[4],a[1]),o(h[3],a[0],a[1],s),o(h[4],a[1],a[5],s),o(h[5],a[4],a[5],s),o(h[6],a[4],a[0],s),o(h[7],a[2],a[6],s),o(h[8],a[7],a[6],s),o(h[9],a[7],a[3],s),o(h[10],a[3],a[2],s),o(h[11],a[0],a[2],s),o(h[12],a[1],a[3],s),o(h[13],a[7],a[5],s),o(h[14],a[6],a[4],s);var u,c,d=null;for(u=0;l>u;u++){var p=h[u];if(0!==p.x||0!==p.y||0!==p.z){var f=null,g=null;for(c=0;c<a.length;c++){var x=p.dotProduct(a[c]);(null===f||f>x)&&(f=x),(null===g||x>g)&&(g=x)}var m=p.dotProduct(s),v=m-t.r,y=m+t.r;if(v>g||f>y)return null;var R=g-v;Math.abs(y-f)<Math.abs(R)&&(R=y-f),Math.abs(f-y)<Math.abs(R)&&(R=f-y),Math.abs(v-g)<Math.abs(R)&&(R=v-g);var V=p.copy().scaleBy(R);(i&&f>v||!i&&v>f)&&V.negate(),(null===d||d.getLength()>V.getLength())&&(d=V,d.distance=R,d.normal=p)}}return d},VROne.Geometry.prototype.sphereSphereCollision=function(e,t){var i=e.position.copy().addVector3(e.offset),r=t.position.copy().addVector3(t.offset),n=i.copy().subtract(r.x,r.y,r.z).getLength();if(n<e.r+t.r){var o=e.position,a=t.position.copy().subtract(o.x,o.y,o.z).normalize().scaleBy(e.r+t.r-n);return a.distance=n,a.normal=a,a}return null},VROne.Timer=function(){},VROne.Timer.prototype={},VROne.Timer.prototype.getCurrentTimeMs=function(){return(new Date).getTime()},VROne.XMLLoader=function(){},VROne.XMLLoader.getSourceSynch=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),200==t.status?t.responseText:null},VROne.XMLLoader.prototype={},VROne.Renderer=function(e){var t,i=0,r=this;this.width=0,this.height=0,this.clearColor={red:0,green:0,blue:0},this.init=function(){e.width=this.width,e.height=this.height,o(e),n()},this.resize=function(){e.width=this.width,e.height=this.height,t.viewportWidth=e.width,t.viewportHeight=e.height,r.setViewportAndScissor(0,0,t.viewportWidth,t.viewportHeight)};var n=function(){t.clearColor(r.clearColor.red,r.clearColor.green,r.clearColor.blue,1),r.setViewportAndScissor(0,0,t.viewportWidth,t.viewportHeight),t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),t.cullFace(t.FRONT),t.frontFace(t.CW),t.enable(t.SCISSOR_TEST)},o=function(e){try{var i={alpha:!1};t=e.getContext("webgl",i),t||(t=e.getContext("experimental-webgl",i)),t.viewportWidth=e.width,t.viewportHeight=e.height,t.ext=null,t.shaders={}}catch(r){}t||alert("Could not initialise WebGL.")};this.update=function(e,t,r){for(i=0;i<t.length;i++)t[i].buffer.update(e);for(i=0;i<r.length;i++)r[i].buffer.update(e)},this.render=function(e,r,n){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);var o;for(i=0;i<r.length;i++)o=r[i].buffer,o.render();for(i=0;i<n.length;i++)o=n[i].buffer,o.render()},this.setViewportAndScissor=function(e,i,r,n){t.viewport(e,i,r,n),t.scissor(e,i,r,n),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},this.getBuffer=function(e,i){if(!e instanceof VROne.Object3D)throw"Can't get Buffer for "+e;return new VROne.BufferMulti(t,e,i)},this.getCanvasHeight=function(){return t.viewportHeight},this.getCanvasWidth=function(){return t.viewportWidth},this.getGL=function(){return t}},VROne.Renderer.prototype={},VROne.VRRenderer=function(e,t,i){function r(){var e=h.createFramebuffer();h.bindFramebuffer(h.FRAMEBUFFER,e),p=e.width=1024,f=e.height=1024;var t=h.createTexture();h.bindTexture(h.TEXTURE_2D,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,e.width,e.height,0,h.RGBA,h.UNSIGNED_BYTE,null);var i=h.createRenderbuffer();return h.bindRenderbuffer(h.RENDERBUFFER,i),h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_COMPONENT16,e.width,e.height),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,t,0),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,i),h.bindTexture(h.TEXTURE_2D,null),h.bindRenderbuffer(h.RENDERBUFFER,null),h.bindFramebuffer(h.FRAMEBUFFER,null),[e,t]}function n(){var e,t=m.vertices.slice();for(e=O;e<=m.vertices.length;e+=O)t.splice(e+(e/O-1)*w,0,m.textureCoords[(e/O-1)*w],m.textureCoords[(e/O-1)*w+1]);V=4*(O+w),x=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,x),h.bufferData(h.ARRAY_BUFFER,new Float32Array(t),h.STATIC_DRAW),x.numItems=4,h.enableVertexAttribArray(g.vertexPositionAttribute),h.vertexAttribPointer(g.vertexPositionAttribute,O,h.FLOAT,!1,V,0),h.enableVertexAttribArray(g.textureCoordAttribute),h.vertexAttribPointer(g.textureCoordAttribute,w,h.FLOAT,!1,V,4*O)}function o(e,t){h.bindFramebuffer(h.FRAMEBUFFER,l),y.setViewportAndScissor(0,0,p,f),s(e,"left"),s(t,"left"),h.bindFramebuffer(h.FRAMEBUFFER,u),y.setViewportAndScissor(0,0,p,f),s(e,"right"),s(t,"right"),h.bindFramebuffer(h.FRAMEBUFFER,null),g.initShaders(),h.bindBuffer(h.ARRAY_BUFFER,x),h.vertexAttribPointer(g.vertexPositionAttribute,O,h.FLOAT,!1,V,0),h.vertexAttribPointer(g.textureCoordAttribute,w,h.FLOAT,!1,V,4*O),h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,c),h.uniform1i(g.samplerUniform,0),y.setViewportAndScissor(0,0,h.viewportWidth,h.viewportHeight),h.uniformMatrix4fv(g.pMatrixUniform,!1,v.getPerspectiveMatrix().data),h.uniformMatrix4fv(g.mvMatrixUniform,!1,v.getViewMatrix().data),h.drawArrays(h.TRIANGLE_STRIP,0,x.numItems),h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,d),h.uniform1i(g.samplerUniform,0),y.setViewportAndScissor(h.viewportWidth,0,h.viewportWidth,h.viewportHeight),h.uniformMatrix4fv(g.pMatrixUniform,!1,v.getPerspectiveMatrix().data),h.uniformMatrix4fv(g.mvMatrixUniform,!1,v.getViewMatrix().data),h.drawArrays(h.TRIANGLE_STRIP,0,x.numItems),h.bindTexture(h.TEXTURE_2D,null)}function a(e,t){y.setViewportAndScissor(0,0,h.viewportWidth,h.viewportHeight),s(e,"left"),s(t,"left"),y.setViewportAndScissor(h.viewportWidth,0,h.viewportWidth,h.viewportHeight),s(e,"right"),s(t,"right")}function s(e,t){for(var i=0;i<e.length;i++)e[i].buffer.renderVR(t)}VROne.Renderer.call(this,e);var h,l,u,c,d,p,f,g,x,m,v,y=this,R=0,V=0,O=3,w=2;this.resize=function(){i?(e.width=i.cameraProperties.renderRectWidth,e.height=i.cameraProperties.renderRectHeight):(console.warn("Can't get renderRect from cameraProperties."),e.width=this.width*window.devicePixelRatio,e.height=this.height*window.devicePixelRatio),e.style.width=this.width+"px",e.style.height=this.height+"px",console.log("Resolution: "+e.width+"x"+e.height+" Style:"+e.style.width+":"+e.style.height),h.viewportWidth=e.width/2,h.viewportHeight=e.height,y.setViewportAndScissor(0,0,h.viewportWidth,h.viewportHeight)};var M=this.init;this.init=function(){console.log("Initializing VRRenderer"),M(),h=this.getGL();var e=r();l=e[0],c=e[1],e=r(),u=e[0],d=e[1],m=new VROne.VRSquare;var t=VROne.VRRenderer.prototype.vrCanvasVert,i=VROne.VRRenderer.prototype.vrCanvasFrag;g=new VROne.Shader(h,t,i),g.pMatrixUniform=g.getUniformLocation("uPMatrix"),g.mvMatrixUniform=g.getUniformLocation("uMVMatrix"),g.vertexPositionAttribute=g.getAttribLocation("aVertexPosition"),g.textureCoordAttribute=g.getAttribLocation("aTextureCoord"),g.samplerUniform=g.getUniformLocation("uSampler");var o=new VROne.CameraModifier;o.getPosition().set(0,0,2.3),o.getOrientation().set(0,0,0,1);var a=new VROne.CameraManager;a.modifiers.push(o),v=new VROne.Camera(a),v.isOrtho=!0,v.updateProjectionMatrix(),v.update(),n(),h.enable(h.SCISSOR_TEST)},this.update=function(e,t,i){for(R=0;R<t.length;R++)t[R].buffer.updateVR(e);for(R=0;R<i.length;R++)i[R].buffer.updateVR(e)},this.render=function(e,i,r){t?o(i,r):a(i,r)}},VROne.VRRenderer.prototype=new VROne.Renderer,VROne.VRRenderer.prototype.vrCanvasVert="attribute vec3 aVertexPosition;attribute vec2 aTextureCoord;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;varying vec2 vTextureCoord;void main(void) {gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);vTextureCoord = aTextureCoord;}",VROne.VRRenderer.prototype.vrCanvasFrag="precision mediump float;uniform sampler2D uSampler;uniform bool uUseTextures;varying vec2 vTextureCoord;varying vec4 vColor;void main(void) {    float distance = sqrt(abs(0.5-vTextureCoord.s)*abs(0.5-vTextureCoord.s)+abs(0.5-vTextureCoord.t)*abs(0.5-vTextureCoord.t));    float distanceS = (0.5-vTextureCoord.s);    float distanceT = (0.5-vTextureCoord.t);    float factor = 1.0+0.22*distance*distance+0.24*distance*distance*distance*distance;    float newCoordS = (vTextureCoord.s-0.5)*factor;    float newCoordT = (vTextureCoord.t-0.5)*factor;    float offsetR = 1.0;    float offsetG = 0.995;    float offsetB = 0.980;    float newCoordSR = newCoordS/offsetR+0.5;    float newCoordSG = newCoordS/offsetG+0.5;    float newCoordSB = newCoordS/offsetB+0.5;    float newCoordTR = newCoordT/offsetR+0.5;    float newCoordTG = newCoordT/offsetG+0.5;    float newCoordTB = newCoordT/offsetB+0.5;    if(newCoordSR<0.0||newCoordSR>1.0    ||newCoordSG<0.0||newCoordSG>1.0    ||newCoordSB<0.0||newCoordSB>1.0    ||newCoordTR<0.0||newCoordTR>1.0    ||newCoordTG<0.0||newCoordTG>1.0    ||newCoordTB<0.0||newCoordTB>1.0){        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);    }else{        float r = texture2D(uSampler, vec2(newCoordSR, newCoordTR)).r;        float g = texture2D(uSampler, vec2(newCoordSG, newCoordTG)).g;        float b = texture2D(uSampler, vec2(newCoordSB, newCoordTB)).b;        gl_FragColor = vec4(r, g, b, 1.0);    }}",VROne.Scene=function(e){var t=0,i=!0,r=new VROne.Camera(new VROne.CameraManager),n=new VROne.AudioContext,o=null,a=new VROne.KeyboardHandler;
this.render=!0,this.width=e.parentNode.clientWidth,this.height=e.parentNode.clientHeight;var s=[],h=[],l=new VROne.LightContainer,u=[];this.resize=function(){this.width=e.parentNode.clientWidth,this.height=e.parentNode.clientHeight,o.width=this.width,o.height=this.height,o.resize(),r.width=o.getCanvasWidth(),r.height=o.getCanvasHeight(),r.updateProjectionMatrix()},this.useWebVR=function(){var t=!0;if(VROne.HMDHandler.isWebVRReady()){var i=r.getManager();i.modifiers.push(new VROne.WebVR),this.setRenderer(new VROne.VRRenderer(e,!1,i)),r.useVR=!0,this.resize()}else console.warn("Browser dosen't support WebVR."),t=!1;return t},this.useCardboard=function(e){this.setRendererVR(e),r.getManager().modifiers.push(new VROne.Cardboard),r.useVR=!0,this.resize()},this.useMotionSensor=function(){r.getManager().modifiers.push(new VROne.Cardboard)},this.setRendererDesktop=function(){this.setRenderer(new VROne.Renderer(e)),r.useVR=!1,this.resize()},this.setRendererVR=function(t){this.setRenderer(new VROne.VRRenderer(e,t)),r.useVR=!0,this.resize()},this.setRenderer=function(t){var i=null;o&&(t.clearColor=o.clearColor,i=o.getGL().shaders),o=t,o.width=this.width,o.height=this.height,o.init(),e.style.width="auto",e.style.height="auto",null!==i&&(o.getGL().shaders=i)},this.setRendererNull=function(){o=null},this.setRendererDesktop(),window.attachEvent?window.attachEvent("onresize",this.resize):window.addEventListener&&window.addEventListener("resize",this.resize,!0),this.updateScene=function(){for(i&&(c(s),c(h),i=!1),a.update(),r.update(),l.update(r),t=0;t<s.length;t++)s[t].update();for(t=0;t<h.length;t++)h[t].update();for(o.update(r,s,h),t=0;t<u.length;t++){u[t].listenerPosition=r.getManager().getGlobalPosition();var e=r.getManager().getGlobalRotation(),n=e.getForwardVector(),d=e.getUpVector();u[t].listenerOrientationFront.x=n.x,u[t].listenerOrientationFront.y=n.y,u[t].listenerOrientationFront.z=n.z,u[t].listenerOrientationUp.x=d.x,u[t].listenerOrientationUp.y=d.y,u[t].listenerOrientationUp.z=d.z,u[t].update()}},this.drawScene=function(){if(this.render&&!i){for(var e=0,t=0;t<h.length;t++)if(!h[t].renderPriority){var n=h[t].getGlobalPosition(),a=r.getManager();h[t].distance=Math.sqrt(Math.pow(a.getGlobalPosition().x-n.x,2)+Math.pow(a.getGlobalPosition().y-n.y,2)+Math.pow(a.getGlobalPosition().z-n.z,2)),h[t].distance>e&&(e=h[t].distance)}for(t=0;t<h.length;t++)h[t].renderPriority&&(h[t].distance=h[t].renderPriority>0?e+h[t].renderPriority:h[t].renderPriority);h.sort(function(e,t){return t.distance-e.distance}),o.render(r,s,h)}};var c=function(e){for(t=0;t<e.length;t++)e[t].buffer&&e[t].buffer.dispose(),e[t].buffer=o.getBuffer(e[t],l)};this.addToScene=function(e){if(e instanceof VROne.Light)l.addLight(e),i=!0;else if(e instanceof VROne.Object3D)i||(e.buffer=o.getBuffer(e,l)),e.calcBoundingBox(),e.calcBoundingSphere(),e.transparent?h.push(e):s.push(e);else{if(!(e instanceof VROne.Sound))throw"Can't add to scene. Unknown type: "+typeof e;e.init(n),u.push(e)}},this.removeFromScene=function(e){if(e instanceof VROne.Light)l.removeLight(e);else if(e instanceof VROne.Object3D){for(t=0;t<s.length;t++)s[t]===e&&s.splice(t,1);for(t=0;t<h.length;t++)h[t]===e&&h.splice(t,1)}else{if(!(e instanceof VROne.Sound))throw"Can't remove from scene: "+typeof e;for(t=0;t<u.length;t++)u[t]===e&&(u[t].stop(),u.splice(t,1))}},this.getCamera=function(){return r},this.setClearColor=function(e,t,i){o.clearColor.red=e,o.clearColor.green=t,o.clearColor.blue=i,o.getGL().clearColor(e,t,i,1)},this.setAmbientLight=function(e,t,i){l.ambientLight.red=e,l.ambientLight.green=t,l.ambientLight.blue=i}},VROne.Light=function(){this.position=new VROne.Vector3,this.color={red:1,green:1,blue:1},this.specularColor={red:1,green:1,blue:1}},VROne.LightContainer=function(){var e=[];this.locationsArray=[],this.locationsArrayLeftEye=[],this.locationsArrayRightEye=[],this.colorsArray=[],this.specColorsArray=[],this.lightsCount=0,this.ambientLight={red:.5,green:.5,blue:.5};var t=new VROne.Vector3;this.addLight=function(t){e.push(t),this.lightsCount=e.length},this.removeLight=function(t){var i=e.indexOf(t);-1!==i&&e.splice(i,1),this.locationsArray.splice(i,1),this.colorsArray.splice(i,1),this.specColorsArray.splice(i,1)},this.update=function(i){var r,n,o=0;if(i.useVR){for(r=i.getViewMatrix("left"),o=0;o<e.length;o++)VROne.Vector3.prototype.copyToVector(e[o].position,t),n=r.transformVector(t),this.locationsArrayLeftEye[3*o+0]=n.x,this.locationsArrayLeftEye[3*o+1]=n.y,this.locationsArrayLeftEye[3*o+2]=n.z;for(r=i.getViewMatrix("right"),o=0;o<e.length;o++)VROne.Vector3.prototype.copyToVector(e[o].position,t),n=r.transformVector(t),this.locationsArrayRightEye[3*o+0]=n.x,this.locationsArrayRightEye[3*o+1]=n.y,this.locationsArrayRightEye[3*o+2]=n.z}else for(r=i.getViewMatrix(),o=0;o<e.length;o++)VROne.Vector3.prototype.copyToVector(e[o].position,t),n=r.transformVector(t),this.locationsArray[3*o+0]=n.x,this.locationsArray[3*o+1]=n.y,this.locationsArray[3*o+2]=n.z;for(o=0;o<e.length;o++)this.colorsArray[3*o+0]=e[o].color.red,this.colorsArray[3*o+1]=e[o].color.green,this.colorsArray[3*o+2]=e[o].color.blue,this.specColorsArray[3*o+0]=e[o].specularColor.red,this.specColorsArray[3*o+1]=e[o].specularColor.green,this.specColorsArray[3*o+2]=e[o].specularColor.blue;this.lightsCount=e.length}},VROne.LightContainer.prototype={},VROne.Buffer=function(e,t,i,r,n,o){o=o||e.TRIANGLES;var a,s,h,l,u=[],c=[],d=[];this.indices=null,this.useTexture=!1,this.useSpecularMap=!1,this.useTransparency=!1,this.texturesO3D=null,this.isSkybox=!1;var p=!1,f=!1,g=!1,x=0,m=0;this.init=function(){p=this.useTexture,f=this.useSpecularMap,g=this.useNormalMap;var o,v=0;for(x=0;x<r.length;x++)o=r[x],o[3]=i.getAttribLocation(o[0]),o[4]=v,v+=4*o[1],m+=4*o[1];for(x=0;x<n.length;x++){var y=n[x];y[4]=new Array(1+y[3].length),y[4][0]=i.getUniformLocation(y[0])}if(this.useTexture)for(i.samplerUniform=i.getUniformLocation("uSampler"),x=0;x<this.texturesO3D.length;x++)u.push(this.loadTexture(e,this.texturesO3D[x],this.isSkybox));if(this.useSpecularMap)for(this.texturesO3D=Array.isArray(t.specularMap)?t.specularMap:[t.specularMap],i.specularMapUniform=i.getUniformLocation("uSpecularMapSampler"),x=0;x<this.texturesO3D.length;x++)c.push(this.loadTexture(e,this.texturesO3D[x],this.isSkybox));if(this.useNormalMap)for(this.texturesO3D=Array.isArray(t.normalMap)?t.normalMap:[t.normalMap],i.normalMapUniform=i.getUniformLocation("uNormalMapSampler"),x=0;x<this.texturesO3D.length;x++)d.push(this.loadTexture(e,this.texturesO3D[x],this.isSkybox));for(var R=[],V=0;V<r[0][2].length/r[0][1];V++)for(x=0;x<r.length;x++)o=r[x],this.pushData(R,o[2],V,o[1]);if(s=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array(R),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),a=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),h=this.indices.length,e.ext){for(l=e.ext.createVertexArrayOES(),e.ext.bindVertexArrayOES(l),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bindBuffer(e.ARRAY_BUFFER,s),x=0;x<r.length;x++)o=r[x],this.setupAttribPointer(e,o[3],o[1],m,o[4]),v+=4*o[1];e.bindBuffer(e.ARRAY_BUFFER,null),e.ext.bindVertexArrayOES(null)}},this.update=function(){p&&(p=v(p,u)),f&&(f=v(f,c)),g&&(g=v(g,d))};var v=function(e,t){if(e){var i=!0;for(x=0;x<t.length;x++)if(!t[x].loaded){i=!1;break}e=!i}return e};this.render=function(){if(!(p||f||g)){if(this.useTransparency&&(e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)),i.initShaders(),this.useTexture&&this.activateTextures(e,i.samplerUniform,u),this.useSpecularMap){for(x=0;x<c.length;x++)e.activeTexture(e.TEXTURE0+u.length+x),e.bindTexture(e.TEXTURE_2D,c[x]);e.uniform1i(i.specularMapUniform,1)}if(this.useNormalMap){for(x=0;x<d.length;x++)e.activeTexture(e.TEXTURE0+u.length+x),e.bindTexture(e.TEXTURE_2D,d[x]);e.uniform1i(i.normalMapUniform,1)}for(x=0;x<n.length;x++){var t=n[x];if(t[4][1]=t[3],t[2])for(var v=0;v<t[3].length;v++)t[4][v+1]=t[2][t[3][v]]}for(x=0;x<n.length;x++)e[n[x][1]].apply(e,n[x][4]);if(e.ext)e.ext.bindVertexArrayOES(l),e.drawElements(o,h,e.UNSIGNED_SHORT,0),e.ext.bindVertexArrayOES(null);else{for(e.bindBuffer(e.ARRAY_BUFFER,s),x=0;x<r.length;x++){var y=r[x];this.setupAttribPointer(e,y[3],y[1],m,y[4])}e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.drawElements(o,h,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}this.useTransparency&&e.disable(e.BLEND)}},this.dispose=function(){e.deleteBuffer(a),e.deleteBuffer(s)}},VROne.Buffer.prototype={pushData:function(e,t,i,r){var n;for(n=0;r>n;n++)e.push(t[i*r+n])},setupAttribPointer:function(e,t,i,r,n){e.enableVertexAttribArray(t),e.vertexAttribPointer(t,i,e.FLOAT,!1,r,n)},loadedTextures:{},loadTexture:function(e,t,i){var r=e.createTexture();r.loaded=!1;var n=e.REPEAT;return(i||t.clamp)&&(n=e.CLAMP_TO_EDGE),t=t.source?t.source:t,this.loadedTextures[t]?(r.loaded=!0,this.loadedTextures[t]):(r.image=new Image,r.image.src=t,r.image.onload=function(){e.bindTexture(e.TEXTURE_2D,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r.image),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,n),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null),r.loaded=!0},this.loadedTextures[t]=r,r)},activateTextures:function(e,t,i){for(var r=[],n=0;n<i.length;n++)e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,i[n]),r.push(n);e.uniform1iv(t,r)}},VROne.BufferMulti=function(e,t,i){if(!t instanceof VROne.Object3D)throw"Can't create buffers for "+t;var r=new VROne.Matrix4;r.transposeUniform=!1;var n=new VROne.Matrix4,o=new VROne.Matrix4,a=new VROne.Matrix3,s=new VROne.Matrix3,h=null,l=null,u=3,c=3,d=2,p=1,f=4,g=Boolean(t.normals)&&i.lightsCount>0,x=Boolean(t.normals)&&(g||t.shader),m=Array.isArray(t.imageSrc)?t.imageSrc.length:1,v=t.isWireframe;this.transparent=t.transparent;var y=Boolean(t.geometries&&t.velocities&&t.rotationAngles&&t.lifetimes&&t.gravities&&t.gravityExps),R=[];R.push(["aVertexPosition",u,t.vertices]),t.textureCoords&&t.imageSrc&&R.push(["aTextureCoord",d,t.textureCoords]),t.textureCoords&&t.imageSrc&&t.textureIndices&&m>1&&R.push(["aTextureIndex",p,t.textureIndices]),t.colors&&R.push(["aVertexColor",f,t.colors]),x&&R.push(["aVertexNormal",c,t.normals]),t.shaderAttributes&&Array.prototype.push.apply(R,t.shaderAttributes);var V={transposeUniform:!1,data:[]},O={time:0,startTime:Date.now()},w={useTexture:Boolean(t.textureCoords&&t.imageSrc),useLighting:g,useMultiTex:Boolean(t.textureIndices),normalMatrix:new VROne.Matrix3,useSpecularMap:Boolean(t.specularMap),useNormalMap:Boolean(t.normalMap)},M=[];M.push(["uPMatrix","uniformMatrix4fv",V,["transposeUniform","data"]]),M.push(["uMVMatrix","uniformMatrix4fv",r,["transposeUniform","data"]]),x&&(w.normalMatrix.transposeUniform=!1,M.push(["uNMatrix","uniformMatrix3fv",w.normalMatrix,["transposeUniform","data"]])),g&&(M.push(["uAmbientColor","uniform3f",i.ambientLight,["red","green","blue"]]),M.push(["uLightIndex","uniform1f",i,["lightsCount"]]),M.push(["uPointLightingLocations","uniform3fv",i,["locationsArray"]]),M.push(["uPointLightingColors","uniform3fv",i,["colorsArray"]]),M.push(["uSpecularColors","uniform3fv",i,["specColorsArray"]]),M.push(["uShininess","uniform1f",t,["shininess"]])),y&&M.push(["uTime","uniform1f",O,["time"]]),t.shaderUniforms&&Array.prototype.push.apply(M,t.shaderUniforms);var b=null,S=null,C="";if(t.shader)b=VROne.XMLLoader.getSourceSynch(t.shader+".vert"),S=VROne.XMLLoader.getSourceSynch(t.shader+".frag"),C="A"+t.shader,t.logVertexShader&&console.log(b),t.logFragmentShader&&console.log(S);else{var T=new VROne.ShaderGenerator;g&&(T.useVertexLighting=Boolean(t.normals&&!t.useFragmentLighting),T.lightsCount=i.lightsCount,T.useFragmentLighting=Boolean(t.normals&&t.useFragmentLighting),T.useSpecularLighting=t.useSpecularLighting),T.useNormals=x,T.useColor=Boolean(t.colors),T.texturesCount=Array.isArray(t.imageSrc)?t.imageSrc.length:1,T.useTexture=Boolean(t.imageSrc&&t.textureCoords),T.useSpecularMap=Boolean(t.specularMap&&t.useSpecularLighting),T.useNormalMap=Boolean(t.normalMap),T.isParticleSystem=y,T.init(),b=T.vertexShader,S=T.fragmentShader,C="B"+T.useNormals+T.lightsCount+T.texturesCount+T.useVertexLighting+T.useFragmentLighting+T.useTexture+T.useColor+T.useSpecularMap+T.useNormalMap+T.isParticleSystem,t.logVertexShader&&console.log(b.replace(/;/g,";\n").replace(/{/g,"{\n").replace(/}/g,"}\n")),t.logFragmentShader&&console.log(S.replace(/;/g,";\n").replace(/{/g,"{\n").replace(/}/g,"}\n"))}var A=null;e.shaders[C]?A=e.shaders[C]:(A=new VROne.Shader(e,b,S),e.shaders[C]=A);var z=v?e.LINES:void 0,P=new VROne.Buffer(e,t,A,R,M,z);if(t.twoFaceTransparency){var E=t.indices;E=E.slice().reverse().concat(E),P.indices=new Uint16Array(E)}else P.indices=new Uint16Array(t.indices);P.useTexture=Boolean(t.textureCoords&&t.imageSrc),P.useSpecularMap=Boolean(t.textureCoords&&t.specularMap),P.useNormalMap=Boolean(t.textureCoords&&t.normalMap),P.useTransparency=t.transparent,P.texturesO3D=Array.isArray(t.imageSrc)?t.imageSrc:[t.imageSrc],P.isSkybox=Boolean(t.isSkybox),P.init();var L=new VROne.Matrix4;this.update=function(e){VROne.Matrix4.prototype.copyToMatrix(t.modelMatrix,r),r.apply(e.getViewMatrix()),VROne.Matrix4.prototype.copyToMatrix(r,L),L.invert(),L.transpose(),L.getMatrix3(w.normalMatrix),V.data=e.getPerspectiveMatrix().data,O=Date.now()-O.startTime,P.update()},this.render=function(){t.visible&&P.render()},this.updateVR=function(e){VROne.Matrix4.prototype.copyToMatrix(t.modelMatrix,n),n.apply(e.getViewMatrix("left")),VROne.Matrix4.prototype.copyToMatrix(n,L),L.invert(),L.transpose(),L.getMatrix3(a),VROne.Matrix4.prototype.copyToMatrix(t.modelMatrix,o),o.apply(e.getViewMatrix("right")),VROne.Matrix4.prototype.copyToMatrix(o,L),L.invert(),L.transpose(),L.getMatrix3(s),h=e.getPerspectiveMatrix("left"),l=e.getPerspectiveMatrix("right"),P.update()},this.renderVR=function(e){t.visible&&("left"===e?(r.data=n.data,w.normalMatrix.data=a.data,V.data=h.data,i.locationsArray=i.locationsArrayLeftEye):"right"===e&&(r.data=o.data,w.normalMatrix.data=s.data,V.data=l.data,i.locationsArray=i.locationsArrayRightEye),P.render())},this.dispose=function(){P.dispose()}},VROne.BufferMulti.prototype={},VROne.Shader=function(e,t,i){var r=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))return alert("ShaderVert: \n"+e.getShaderInfoLog(r)),null;var n=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(n,i),e.compileShader(n),!e.getShaderParameter(r,e.COMPILE_STATUS))return alert("ShaderFrag: \n"+e.getShaderInfoLog(n)),null;var o=e.createProgram();e.attachShader(o,r),e.attachShader(o,n),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||alert("Could not initialise shaders"),e.validateProgram(o),this.initShaders=function(){e.useProgram(o)},this.getAttribLocation=function(t){return e.getAttribLocation(o,t)},this.getUniformLocation=function(t){return e.getUniformLocation(o,t)}},VROne.Shader.prototype={},VROne.ShaderGenerator=function(){this.lightsCount=4,this.texturesCount=1,this.useNormals=!1,this.useVertexLighting=!1,this.useFragmentLighting=!1,this.useSpecularLighting=!1,this.useTexture=!1,this.useColor=!1,this.useSpecularMap=!1,this.useNormalMap=!1,this.isParticleSystem=!1;var e=!1;this.vertexShader="",this.fragmentShader="",this.init=function(){this.useTexture||(this.useSpecularMap=!1,this.useNormalMap=!1),e=Boolean(this.texturesCount>1),this.vertexShader+="attribute vec3 aVertexPosition;",this.useColor&&(this.vertexShader+="attribute vec4 aVertexColor;"),this.useTexture&&(this.vertexShader+="attribute vec2 aTextureCoord;"),this.useNormals&&(this.vertexShader+="attribute vec3 aVertexNormal;"),this.isParticleSystem&&(this.vertexShader+="attribute vec3 aGeometryPosition;attribute vec3 aVertexVelocity;attribute vec3 aVertexRotation;attribute float aLifetime;attribute float aGravity;attribute float aGravityExponent;"),this.useTexture&&e&&(this.vertexShader+="attribute float aTextureIndex;"),this.vertexShader+="uniform mat4 uMVMatrix;uniform mat4 uPMatrix;",this.isParticleSystem&&(this.vertexShader+="uniform float uTime;"),this.useNormals&&(this.vertexShader+="uniform mat3 uNMatrix;"),this.useVertexLighting&&(this.vertexShader+="uniform vec3 uAmbientColor;uniform vec3 uPointLightingLocations["+this.lightsCount+"];uniform vec3 uPointLightingColors["+this.lightsCount+"];uniform float uLightIndex;",this.useSpecularLighting&&(this.vertexShader+="uniform float uShininess;"),this.useSpecularLighting&&(this.vertexShader+="uniform vec3 uSpecularColors["+this.lightsCount+"];")),this.useColor&&(this.vertexShader+="varying vec4 vColor;"),this.useTexture&&(this.vertexShader+="varying vec2 vTextureCoord;"),this.useVertexLighting?this.vertexShader+="varying vec3 vLightWeighting;":this.useFragmentLighting&&(this.vertexShader+="varying vec3 vTransformedNormal;varying vec4 vPosition;"),this.useTexture&&e&&(this.vertexShader+="varying float vTextureIndex;"),this.vertexShader+="void main(void) {",this.isParticleSystem?this.vertexShader+="float factor;if(aLifetime==0.0){factor = uTime;}else{factor = mod(uTime, aLifetime);}vec3 distance = aGeometryPosition - aVertexPosition;float xAngle = aVertexRotation.x*factor;float yAngle = aVertexRotation.y*factor;float zAngle = aVertexRotation.z*factor;mat4 xRotation = mat4(1.0,	 		 0.0,			 0.0,			 0.0,0.0,			 cos(xAngle),	 sin(xAngle),	 0.0,0.0,			-sin(xAngle),	 cos(xAngle),	 0.0,0.0,	 		 0.0,			 0.0,			 1.0);mat4 yRotation = mat4(cos(yAngle),	 0.0,			-sin(yAngle),	 0.0,0.0,			 1.0,	 		 0.0,			 0.0,sin(yAngle),	 0.0,	 		 cos(yAngle),	 0.0,0.0,			 0.0,	 		 0.0,			 1.0);mat4 zRotation = mat4(cos(zAngle),	 sin(zAngle),	 0.0,			 0.0,-sin(zAngle),	 cos(zAngle),	 0.0,			 0.0,0.0,			 0.0,			 1.0,			 0.0,0.0,			 0.0,			 0.0,			 1.0);vec4 position = vec4(aGeometryPosition, 1.0)*xRotation*yRotation*zRotation;position = position-vec4(distance, 0.0);vec3 velocity = aVertexVelocity+vec3(0.0, aGravity*pow(factor, aGravityExponent),0.0);position = uMVMatrix * vec4(position.xyz+velocity*factor, 1.0);":this.useFragmentLighting?this.useFragmentLighting&&(this.vertexShader+="vPosition = uMVMatrix * vec4(aVertexPosition, 1.0);vec4 position = vPosition;"):this.vertexShader+="vec4 position = uMVMatrix * vec4(aVertexPosition, 1.0);",this.vertexShader+="gl_Position = uPMatrix * position;",this.useTexture&&e&&(this.vertexShader+="vTextureIndex = aTextureIndex;"),this.useTexture&&(this.vertexShader+="vTextureCoord = aTextureCoord;"),this.useColor&&(this.vertexShader+="vColor = aVertexColor;"),this.useVertexLighting?(this.vertexShader+="vLightWeighting = uAmbientColor;",this.vertexShader+=this.isParticleSystem?"vec3 transformedNormal = uNMatrix * (vec4(aVertexNormal, 1.0) * xRotation * yRotation * zRotation).xyz;":"vec3 transformedNormal = uNMatrix * aVertexNormal;",this.vertexShader+="vec3 normal = normalize(transformedNormal);vec3 eyeDirection = normalize(-position.xyz);"+this.getVertexLightingWeightCalcArrayVertex(this.lightsCount,this.useSpecularLighting)):this.useFragmentLighting&&(this.vertexShader+=this.isParticleSystem?"vTransformedNormal = uNMatrix * (vec4(aVertexNormal, 1.0) * xRotation * yRotation * zRotation).xyz;":"vTransformedNormal = uNMatrix * aVertexNormal;"),this.vertexShader+="}",this.fragmentShader+="precision mediump float;",this.useVertexLighting?this.fragmentShader+="varying vec3 vLightWeighting;":this.useFragmentLighting&&(this.fragmentShader+="varying vec3 vTransformedNormal;varying vec4 vPosition;uniform vec3 uAmbientColor;uniform vec3 uPointLightingLocations["+this.lightsCount+"];uniform vec3 uPointLightingColors["+this.lightsCount+"];uniform float uLightIndex;",this.useSpecularLighting&&(this.fragmentShader+="uniform float uShininess;"),this.useSpecularLighting&&(this.fragmentShader+="uniform vec3 uSpecularColors["+this.lightsCount+"];")),this.useColor&&(this.fragmentShader+="varying vec4 vColor;"),this.useTexture&&(this.fragmentShader+="varying vec2 vTextureCoord;",this.fragmentShader+=e?"varying float vTextureIndex;uniform sampler2D uSampler["+this.texturesCount+"];":"uniform sampler2D uSampler;"),this.useSpecularMap&&(this.fragmentShader+="uniform sampler2D uSpecularMapSampler;"),this.useNormalMap&&(this.fragmentShader+="uniform sampler2D uNormalMapSampler;"),this.fragmentShader+="void main(void) {vec4 fragmentColor;",this.useFragmentLighting&&(this.fragmentShader+="vec3 lightWeighting = uAmbientColor;vec3 normal = normalize(vTransformedNormal);vec3 eyeDirection = normalize(-vPosition.xyz);"+this.getFragmentLightingWeightCalcArrayVertex(this.lightsCount,this.useSpecularMap,this.useNormalMap,this.useSpecularLighting)),this.useTexture&&e?(this.fragmentShader+="if (vTextureCoord.x > -0.5 && vTextureCoord.y > -0.5) {vec4 tex = vec4(0.0);float i = vTextureIndex;"+this.getTextureCalcArray(this.texturesCount)+"fragmentColor = tex;} else {",this.fragmentShader+=this.useColor?"fragmentColor = vColor;":"fragmentColor = vec4(0.5, 0.5, 0.5, 1.0);",this.fragmentShader+="}"):this.fragmentShader+=this.useTexture?"fragmentColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));":this.useColor?"fragmentColor = vColor;":"fragmentColor = vec4(0.5, 0.5, 0.5, 1.0);",this.fragmentShader+=this.useVertexLighting?"gl_FragColor = vec4(fragmentColor.rgb * vLightWeighting, fragmentColor.a);":this.useFragmentLighting?"gl_FragColor = vec4(fragmentColor.rgb * lightWeighting, fragmentColor.a);":"gl_FragColor = fragmentColor;",this.fragmentShader+="}"}},VROne.ShaderGenerator.prototype={getVertexLightingWeightCalcArrayVertex:function(e,t){for(var i="",r=0;e>r;r++)i+="if(uLightIndex-"+(r+1)+".0>-0.01){vec3 lightDirection = normalize(uPointLightingLocations["+r+"] - position.xyz);vec3 reflectionDirection = reflect(-lightDirection, normal);float diffuseLightWeighting = max(dot(normalize(transformedNormal), lightDirection), 0.0);",i+=t?"float specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), uShininess);vLightWeighting += uPointLightingColors["+r+"] * diffuseLightWeighting + uSpecularColors["+r+"] * specularLightWeighting;":"vLightWeighting += uPointLightingColors["+r+"] * diffuseLightWeighting;",i+="}";return i},getFragmentLightingWeightCalcArrayVertex:function(e,t,i,r){for(var n="",o=0;e>o;o++)n+="if(uLightIndex-"+(o+1)+".0>-0.01){vec3 lightDirection = normalize(uPointLightingLocations["+o+"] - vPosition.xyz);vec3 reflectionDirection = reflect(-lightDirection, normal);",t?n+="float shininess = texture2D(uSpecularMapSampler, 255.0-vec2(vTextureCoord.s, vTextureCoord.t)).r * 255.0 * uShininess;float specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininess);":r&&(n+="float specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), uShininess);"),n+=i?"vec3 normalMap = texture2D(uNormalMapSampler, vec2(vTextureCoord.s, vTextureCoord.t)).rgb*2.0-1.0;float diffuseLightWeighting = max(dot(normalize(normalMap), lightDirection), 0.0);":"float diffuseLightWeighting = max(dot(normalize(vTransformedNormal), lightDirection), 0.0);",n+=r?"lightWeighting += uPointLightingColors["+o+"] * diffuseLightWeighting + uSpecularColors["+o+"] * specularLightWeighting;":"lightWeighting += uPointLightingColors["+o+"] * diffuseLightWeighting;",n+="}";return n},getTextureCalcArray:function(e){for(var t="",i=0;e>i;i++)0!==i&&(t+="else "),t+="if(i-"+i+".0 < 0.01){tex = texture2D(uSampler["+i+"], vec2(vTextureCoord.s, vTextureCoord.t));}";return t}},VROne.Sound=function(e){var t=this;this.soundLoaded=!1,this.position=new VROne.Vector3(0,0,0),this.orientationFront=new VROne.Vector3(0,0,0),this.orientationUp=new VROne.Vector3(0,1,0),this.listenerPosition=new VROne.Vector3(0,0,0),this.listenerOrientationFront=new VROne.Vector3(0,0,0),this.listenerOrientationUp=new VROne.Vector3(0,1,0),this.loop=!0,this.is3D=!0,this.volume=1,this.isPlaying=!1;var i,r,n,o,a,s,h=0;this.init=function(r){i=r.audioContext;var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){i.decodeAudioData(this.response,function(e){o=e,t.soundLoaded=!0},function(){alert("Decoding the audio buffer failed")})},n.send()},this.update=function(){t.soundLoaded&&t.isPlaying&&(t.is3D&&(r.setPosition(t.position.x,t.position.y,t.position.z),r.panningModel="HRTF",r.distanceModel="linear",i.listener.setOrientation(-t.listenerOrientationFront.x,-t.listenerOrientationFront.y,t.listenerOrientationFront.z,t.listenerOrientationUp.x,t.listenerOrientationUp.y,-t.listenerOrientationUp.z),i.listener.setPosition(-t.listenerPosition.x,-t.listenerPosition.y,-t.listenerPosition.z)),a.gain.value=this.volume,n.loop=this.loop)},this.play=function(){t.soundLoaded?(n=i.createBufferSource(),n.buffer=o,a=i.createGain(),this.is3D?(r=i.createPanner(),n.connect(r),r.connect(a),r.panningModel="HRTF",r.distanceModel="linear"):n.connect(a),a.connect(i.destination),t.update(),n.start(h),s=Date.now(),this.isPlaying=!0):console.error("The audio file is not done loading.")},this.pause=function(){t.soundLoaded?(n.stop(),this.isPlaying=!1,h=(Date.now()-s)%Math.floor(1e3*o.duration)/1e3):console.error("The audio file is not done loading.")},this.stop=function(){t.soundLoaded?(n.stop(),this.isPlaying=!1,h=0):console.error("The audio file is not done loading.")}},VROne.AudioContext=function(){window.AudioContext=window.AudioContext||window.webkitAudioContext||null,window.AudioContext?this.audioContext=new AudioContext:(this.audioContext={},console.error("AudioContext is not supported by your browser"))},VROne.Camera=function(e){var t=this;this.useVR=!1;var i=!1,r=new VROne.Vector3,n=new VROne.Quaternion,o=new VROne.Matrix4,a=new VROne.Matrix4,s=new VROne.Matrix4,h=new VROne.Matrix4,l=null,u=null,c=null;this.fieldOfView=60,this.nearPlane=.1,this.farPlane=200,this.width=1,this.height=1,this.isOrtho=!1;var d=new VROne.Vector3;this.update=function(){e.update(),r=e.getGlobalPosition(),n=e.getGlobalRotation().getConjugate(),p()},this.updateProjectionMatrix=function(){var t=this.width/this.height;e&&e.isInputVR()&&e.cameraProperties.eyeFOVL?(u=VROne.Matrix4.makeVRPerspective(e.cameraProperties.eyeFOVL,this.nearPlane,this.farPlane),c=VROne.Matrix4.makeVRPerspective(e.cameraProperties.eyeFOVR,this.nearPlane,this.farPlane)):l=this.isOrtho?VROne.Matrix4.makeOrthoPerspective(-1,1,1,-1,.5,1.5):VROne.Matrix4.makePerspective(this.fieldOfView,t,this.nearPlane,this.farPlane)},this.setFullscreen=function(t,r){if(i!==t){if(i=t,!t)return void(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen());var n={};void 0!==e.cameraProperties.vrDevice&&(n={vrDisplay:e.cameraProperties.vrDevice,vrTimewarp:!0}),r.requestFullscreen?r.requestFullscreen(n):r.msRequestFullscreen?r.msRequestFullscreen(n):r.mozRequestFullScreen?r.mozRequestFullScreen(n):r.webkitRequestFullscreen&&r.webkitRequestFullscreen(n)}};var p=function(){if(t.useVR){var i=e.cameraProperties.eyeTranslationL,l=e.cameraProperties.eyeTranslationR;s.identity(),s.applyTranslation(-r.x,-r.y,-r.z),n.toRotationMatrix(o),s.apply(o),s.applyTranslation(-i,0,0),h.identity(),h.applyTranslation(-r.x,-r.y,-r.z),n.toRotationMatrix(o),h.apply(o),h.applyTranslation(-l,0,0)}else a.identity(),a.applyTranslation(-r.x,-r.y,-r.z),n.toRotationMatrix(o),a.apply(o)};this.getManager=function(){return e},this.getViewMatrix=function(e){return"left"===e?s:"right"===e?h:a},this.getPerspectiveMatrix=function(e){return"left"===e&&null!==u?u:"right"===e&&null!==c?c:l},this.getEyeTranslation=function(t){return"left"===t?e.cameraProperties.eyeTranslationL:"right"===t?e.cameraProperties.eyeTranslationR:null},this.getForwardVector=function(){return t.useVR?(d.x=-s.data[2],d.y=-s.data[6],d.z=-s.data[10],d):(d.x=-a.data[2],d.y=-a.data[6],d.z=-a.data[10],d)},this.isFullscreen=function(){return i}},VROne.Camera.prototype={},VROne.CameraManager=function(){var e=this,t=new VROne.Vector3,i=new VROne.Quaternion;this.cameraProperties={vrDevice:null,eyeTranslationL:-.03,eyeTranslationR:.03,eyeFOVR:90,renderRectWidth:null,renderRectHeight:null},this.isInputVR=function(){for(r=0;r<this.modifiers.length;r++)if(this.modifiers[r]instanceof VROne.WebVR)return!0;return!1},this.modifiers=[];var r,n=!1,o=function(t){var i=t[0],r=t[1];e.cameraProperties.vrDevice=vrDevice,e.cameraProperties.eyeTranslationL=i.eyeTranslation.x,e.cameraProperties.eyeTranslationR=r.eyeTranslation.x,e.cameraProperties.eyeFOVL=i.recommendedFieldOfView,e.cameraProperties.eyeFOVR=r.recommendedFieldOfView;var n=i.renderRect,o=r.renderRect;e.cameraProperties.renderRectWidth=o.x+o.width,e.cameraProperties.renderRectHeight=Math.max(n.y+n.height,o.y+o.height)};this.update=function(){for(r=0;r<this.modifiers.length;r++)this.modifiers[r].update(this.getGlobalRotation().getConjugate());for(t.nullVector(),i.reset(),r=0;r<this.modifiers.length;r++){if(!n&&this.modifiers[r]instanceof VROne.WebVR){var e=this.modifiers[r].getHMDData();null!==e&&(o(e),n=!0)}i.multiply(i,this.modifiers[r].getOrientation());var a=this.modifiers[r].getPosition();t.add(a.x,a.y,a.z)}},this.getGlobalPosition=function(){return t},this.getGlobalRotation=function(){return i}},VROne.CameraManager.prototype={},VROne.CameraModifier=function(){this.position=new VROne.Vector3,this.orientation=new VROne.Quaternion,this.update=function(){},this.getOrientation=function(){return this.orientation},this.getPosition=function(){return this.position},this.getHMDData=function(){return null}},VROne.Cardboard=function(){VROne.CameraModifier.call(this);var e=new VROne.Quaternion,t=function(e){return e*Math.PI/180};this.update=function(){var i=t(-VROne.SensorsHandler.getRoll()+180),r=t(-VROne.SensorsHandler.getPitch()),n=t(VROne.SensorsHandler.getYaw()+90),o=Math.cos(i/2),a=Math.cos(r/2),s=Math.cos(n/2),h=Math.sin(i/2),l=Math.sin(r/2),u=Math.sin(n/2);e.x=h*l*s+o*a*u,e.y=h*a*s+o*l*u,e.z=-(o*l*s-h*a*u),e.w=o*a*s-h*l*u},this.getOrientation=function(){return e}},VROne.Cardboard.prototype=new VROne.CameraModifier,VROne.WebVR=function(){var e=new VROne.Vector3,t=new VROne.Quaternion;this.getHMDData=function(){return VROne.HMDHandler.getHMDData()};var i=new VROne.Quaternion,r=new VROne.Vector3;this.update=function(n){VROne.KeyboardHandler.isKeyDown("R")&&VROne.HMDHandler.resetSensor();var o=VROne.HMDHandler.getPositionalData();o&&(o.position&&(e.x=o.position.x,e.y=o.position.y,e.z=o.position.z,e.w=o.position.w),t.x=o.orientation.x,t.y=o.orientation.y,t.z=o.orientation.z,t.w=o.orientation.w),e=i.multiply(n,t.getConjugate()).rotatePoint(r),t=t.getConjugate()},this.getPosition=function(){return e},this.getOrientation=function(){return t}},VROne.WebVR.prototype=new VROne.CameraModifier,VROne.MouseKeyboard=function(e,t){var i=.2,r=new VROne.Vector3,n=new VROne.Quaternion;e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;var o=new VROne.Vector3,a=Date.now(),s=new VROne.Quaternion,h=new VROne.Quaternion,l=new VROne.Vector3(1,0,0),u=new VROne.Vector3(0,1,0),c=new VROne.Vector2(0,0),d=0,p=0;this.update=function(e){VROne.MouseHandler.setNewFrameTrue();var t=(Date.now()-a)/1e3,f=5,g=null;o.x=0,o.y=0,o.z=0,VROne.KeyboardHandler.isKeyDown("W")&&(g=o.add(0,0,-1)),VROne.KeyboardHandler.isKeyDown("S")&&(g=o.add(0,0,1)),VROne.KeyboardHandler.isKeyDown("D")&&(g=o.add(1,0,0)),VROne.KeyboardHandler.isKeyDown("A")&&(g=o.add(-1,0,0)),g&&(g=e.getRotatedPoint(g),r.add(g.x*f*t,g.y*f*t,g.z*f*t)),a=Date.now(),c=VROne.MouseHandler.getMovement(),d+=c.x,p+=c.y,p*i>90?p=90/i:-90>p*i&&(p=-90/i),h.reset(),h.fromAxisAngle(u,d*i*Math.PI/180),s.reset(),s.fromAxisAngle(l,p*i*Math.PI/180),s.multiply(s,h),n=s
},this.getPosition=function(){return r},this.getOrientation=function(){return n},t.onclick=function(){e.requestPointerLock()},this.isMouseLocked=function(){return document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e}},VROne.MouseKeyboard.prototype=new VROne.CameraModifier,VROne.Gamepad=function(){var e=this;this.gamepads=[];var t,i=0,r=0,n=.3,o=6,a=3,s=new VROne.Vector3,h=new VROne.Vector3;this.getPosition=function(i){var r=.02;for(h.nullVector(),e.gamepads=VROne.GamepadHandler.getGamepads(),t=0;t<e.gamepads.length;t++)if(e.gamepads[t]){var a=0,l=0;(e.gamepads[t].axes[0]>n||e.gamepads[t].axes[0]<-n)&&(a=e.gamepads[t].axes[0]*o),(e.gamepads[t].axes[1]>n||e.gamepads[t].axes[1]<-n)&&(l=e.gamepads[t].axes[1]*o),h.add(a,0,l)}return h=i.getConjugate().getRotatedPoint(h),s.add(h.x*r,h.y*r,h.z*r),s};var l=new VROne.Quaternion,u=new VROne.Quaternion,c=new VROne.Vector3(1,0,0),d=new VROne.Vector3(0,1,0);this.getOrientation=function(){for(l.reset(),e.gamepads=VROne.GamepadHandler.getGamepads(),t=0;t<e.gamepads.length;t++)e.gamepads[t]&&((e.gamepads[t].axes[2]>n||e.gamepads[t].axes[2]<-n)&&(i+=e.gamepads[t].axes[2]*a),(e.gamepads[t].axes[3]>n||e.gamepads[t].axes[3]<-n)&&(r+=e.gamepads[t].axes[3]*a),u.reset(),u.fromAxisAngle(d,i*Math.PI/180),l.reset(),l.fromAxisAngle(c,r*Math.PI/180),l.multiply(l,u));return l}},VROne.Gamepad.prototype=new VROne.CameraModifier,VROne.Object3D=function(){var e=this;this.position=new VROne.Vector3,this.rotation=new VROne.Quaternion;var t=new VROne.Vector3,i=new VROne.Quaternion,r=new VROne.Matrix4;this.scale=new VROne.Vector3(1,1,1),this.modelMatrix=new VROne.Matrix4,this.parent=null,this.parentPositionWeight=new VROne.Vector3(1,1,1),this.parentRotationWeight=new VROne.Vector3(1,1,1),this.vertices=null,this.normals=null,this.textureCoords=null,this.textureIndices=null,this.colors=null,this.indices=null,this.transparent=!1,this.isWireframe=!1,this.twoFaceTransparency=!1,this.buffer=null,this.imageSrc=null,this.shader=null,this.shaderAttributes=null,this.shaderUniforms=null,this.useFragmentLighting=!1,this.specularMap=null,this.normalMap=null,this.useSpecularLighting=!1,this.shininess=1,this.soundFile=null,this.sound=null,this.isSkybox=!1,this.boundingBox=null,this.boundingSphere=null,this.gravity=null,this.velocity=new VROne.Vector3,this.collision=!1,this.useBoundingSphere=!1,this.collideWith=null,this.onCollision=null;var n=VROne.Timer.prototype.getCurrentTimeMs();this.onUpdate=null,this.renderPriority=null,this.visible=!0,this.logVertexShader=!1,this.logFragmentShader=!1,this.calcBoundingBox=function(){this.vertices||console.error("No Vertices set. Can't calc Bounding Box."),s();for(var e=this.vertices[0],r=this.vertices[0],n=this.vertices[1],o=this.vertices[1],a=this.vertices[2],h=this.vertices[2],l=0;l<this.vertices.length;l+=3){var u=this.vertices[l+0],c=this.vertices[l+1],d=this.vertices[l+2];u>r&&(r=u),e>u&&(e=u),c>o&&(o=c),n>c&&(n=c),d>h&&(h=d),a>d&&(a=d)}var p=r-e,f=o-n,g=h-a;this.boundingBox=new VROne.Geometry.Box(p,f,g),this.boundingBox.position=t,this.boundingBox.offset=new VROne.Vector3(e,n,a),this.boundingBox.rotation=i,this.boundingBox.scale=this.scale},this.calcBoundingSphere=function(){s();var e,r,n,o,a=this.scale,h=this.vertices[0]*a.x,l=this.vertices[0]*a.x,u=this.vertices[1]*a.y,c=this.vertices[1]*a.y,d=this.vertices[2]*a.z,p=this.vertices[2]*a.z;for(e=0;e<this.vertices.length;e+=3)r=this.vertices[e+0]*a.x,n=this.vertices[e+1]*a.y,o=this.vertices[e+2]*a.z,r>l&&(l=r),h>r&&(h=r),n>c&&(c=n),u>n&&(u=n),o>p&&(p=o),d>o&&(d=o);var f=new VROne.Vector3((l+h)/2,(c+u)/2,(p+d)/2),g=0;for(e=0;e<this.vertices.length;e+=3){r=this.vertices[e+0]*this.scale.x,n=this.vertices[e+1]*this.scale.y,o=this.vertices[e+2]*this.scale.z;var x=VROne.Vector3.prototype.distance(f,new VROne.Vector3(r,n,o));x>g&&(g=x)}this.boundingSphere=new VROne.Geometry.Sphere(g),this.boundingSphere.position=t,this.boundingSphere.offset=f,this.boundingSphere.rotation=i},this.update=function(){var e=VROne.Timer.prototype.getCurrentTimeMs(),o=e-n,a=this.gravity,h=this.velocity;if((a||0!==h.x||0!==h.y||0!==h.z)&&o>0){var l=o/1e3;if(a&&((a.x>0&&h.x<a.x||a.x<0&&h.x>a.x)&&(h.x=h.x+a.x*l),(a.y>0&&h.y<a.y||a.y<0&&h.y>a.y)&&(h.y=h.y+a.y*l),(a.z>0&&h.z<a.z||a.z<0&&h.z>a.z)&&(h.z=h.z+a.z*l)),this.position.x+=h.x*l,this.position.y+=h.y*l,this.position.z+=h.z*l,s(),this.collision&&this.collideWith)for(var u=0;u<this.collideWith.length;u++){var c=this.collideWith[u],d=this.boundingSphere.position.x+this.boundingSphere.offset.x-(c.boundingSphere.position.x+c.boundingSphere.offset.x),p=this.boundingSphere.position.y+this.boundingSphere.offset.y-(c.boundingSphere.position.y+c.boundingSphere.offset.y),f=this.boundingSphere.position.z+this.boundingSphere.offset.z-(c.boundingSphere.position.z+c.boundingSphere.offset.z),g=Math.sqrt(d*d+p*p+f*f),x=this.boundingSphere.r+c.boundingSphere.r;if(!(g>1.3*x)){var m;if(m=c.useBoundingSphere&&this.useBoundingSphere?VROne.Geometry.prototype.sphereSphereCollision(this.boundingSphere,c.boundingSphere):c.useBoundingSphere?VROne.Geometry.prototype.boxSphereCollision(this.boundingBox,c.boundingSphere,!0):this.useBoundingSphere?VROne.Geometry.prototype.boxSphereCollision(c.boundingBox,this.boundingSphere):VROne.Geometry.prototype.boxBoxCollision(this.boundingBox,c.boundingBox),m&&(this.position.subtract(m.x,m.y,m.z),this.onCollision)){var v={collisionWith:c,collisionVector:m.negate()};this.onCollision(v)}}}}n=e,s(),this.modelMatrix.identity(),this.modelMatrix.applyScale(this.scale.x,this.scale.y,this.scale.z),i.toRotationMatrix(r),this.modelMatrix.apply(r),this.modelMatrix.applyTranslation(t.x,t.y,t.z),this.onUpdate&&this.onUpdate()};var o=new VROne.Vector3,a=new VROne.Quaternion,s=function(){if(e.parent){var r=e.parent.getGlobalRotation(),n=e.parentRotationWeight;i.x=r.x*n.x,i.y=r.y*n.y,i.z=r.z*n.z,i.w=r.w,VROne.Quaternion.prototype.copyToQuaternion(i,a),i.getConjugate(a),i.normalize(),i.multiply(e.rotation,i);var s=e.parent.getGlobalPosition(),h=e.parentPositionWeight;o.x=e.position.x,o.y=e.position.y,o.z=e.position.z,a.rotatePoint(o),t.x=s.x*h.x+o.x,t.y=s.y*h.y+o.y,t.z=s.z*h.z+o.z}else VROne.Vector3.prototype.copyToVector(e.position,t),VROne.Quaternion.prototype.copyToQuaternion(e.rotation,i)};this.getGlobalPosition=function(){return t},this.getGlobalRotation=function(){return i}},VROne.Object3D.prototype={addShaderAttribute:function(e,t,i){this.shaderAttributes||(this.shaderAttributes=[]),this.shaderAttributes.push([e,t,i])},addShaderUniform:function(e,t,i,r){this.shaderUniforms||(this.shaderUniforms=[]),this.shaderUniforms.push([e,t,i,r])}},VROne.OBJLoader=function(e){for(var t=/(.*[\/|\\])(.*)/,i=t.exec(e)[1],r=t.exec(e)[2],n=VROne.XMLLoader.getSourceSynch(i+r),o=this.getMtlName(n),a=VROne.XMLLoader.getSourceSynch(i+o),s=this.readObj(n),h=o?this.readMtl(a):null,l=[],u=0;u<s.length;u++){var c=this.createO3DFromOBJ(s[u],h,i),d=s[u].name;l.push(c),l[d]=c}return l},VROne.OBJLoader.prototype={readObj:function(e){var t=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,i=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,r=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,n=/f( +-?\d+)( +-?\d+)( +-?\d+)( +-?\d+)?/,o=/f( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))?/,a=/f( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))?/,s=/f( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))?/,h=[],l={};l.name="",l.vertices=[],l.normals=[],l.uvs=[],l.faces=[];for(var u,c=function(e,t,i){if(void 0!==e[3])throw"obj quad rendering not supported";for(var r=[],n=0;3>n;n++){var o=e[n],a=t?t[n]:void 0,s=i?i[n]:void 0;r.push([o,a,s])}r.push(u),l.faces.push(r)},d=e.split("\n"),p=0;p<d.length;p++){var f=d[p];f=f.trim();var g;0!==f.length&&"#"!==f.charAt(0)&&(null!==(g=t.exec(f))?l.vertices.push([parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])]):null!==(g=i.exec(f))?l.normals.push([parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])]):null!==(g=r.exec(f))?l.uvs.push([parseFloat(g[1]),parseFloat(g[2])]):null!==(g=n.exec(f))?c([g[1],g[2],g[3],g[4]]):null!==(g=o.exec(f))?c([g[2],g[5],g[8],g[11]],[g[3],g[6],g[9],g[12]]):null!==(g=a.exec(f))?c([g[2],g[6],g[10],g[14]],[g[3],g[7],g[11],g[15]],[g[4],g[8],g[12],g[16]]):null!==(g=s.exec(f))?c([g[2],g[5],g[8],g[11]],void 0,[g[3],g[6],g[9],g[12]]):/^o /.test(f)||/^g /.test(f)?(l.faces.length>0&&(l.faces=this.getCorrectIndices(l.faces)),l.faces.length>0&&h.push(l),l={},l.name=f.substring(2).trim(),l.vertices=[],l.normals=[],l.uvs=[],l.faces=[]):/^g /.test(f)||/^mtllib /.test(f)||(/^usemtl /.test(f)?u=f.substring(7).trim():/^s /.test(f)))}return h.length>0&&(l.faces=this.getCorrectIndices(l.faces)),h.push(l),h},getMtlName:function(e){for(var t=e.split("\n"),i=0;i<t.length;i++){var r=t[i];if(r=r.trim(),/^mtllib /.test(r))return r.substring(7).trim()}return null},readMtl:function(e){var t=e.split("\n"),i=/Kd ([\d|\.|\+|\-|e|E]+) ([\d|\.|\+|\-|e|E]+) ([\d|\.|\+|\-|e|E]+)/,r={},n=-1;r.mtlName=[],r.kd=[],r.mapKd=[];for(var o=0;o<t.length;o++){var a,s=t[o];/^newmtl /.test(s)?(n++,r.mtlName[n]=s.substring(7).trim()):null!==(a=i.exec(s))?r.kd[n]=[parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),1]:/^map_Kd /.test(s)&&(r.mapKd[n]=s.substring(7).trim())}return r},getCorrectIndices:function(e){for(var t=parseInt(e[0][0][0]),i=parseInt(e[0][0][1]),r=parseInt(e[0][0][2]),n=0;n<e.length;n++)for(var o=0;3>o;o++)parseInt(e[n][o][0])<t&&(t=parseInt(e[n][o][0])),parseInt(e[n][o][1])<i&&(i=parseInt(e[n][o][1])),parseInt(e[n][o][2])<r&&(r=parseInt(e[n][o][2]));t-=1,i-=1,r-=1;for(var n=0;n<e.length;n++)for(var o=0;3>o;o++)e[n][o][0]-=t,e[n][o][1]-=i,e[n][o][2]-=r;return e},createO3DFromOBJ:function(e,t,i){for(var r=[],n=[],o=[],a=[],s=[],h=[],l=[],u=0,c=!t||t.mapKd.length>0,d=!t||c&&t.mapKd.length>1,p=0;p<e.faces.length;p++){var f,g=e.faces[p],x=0,m=!1;if(!t||0===t.kd.length&&0===t.mapKd.length)f=[.5,.5,.5,1];else{var v=t.mtlName.indexOf(g[3]);m=Boolean(t.mapKd[v]),f=m?t.mapKd[v]:t.kd[v],m&&(x=l.indexOf(f),0>x&&(l.push(f),x=l.indexOf(f)))}for(var y=0;3>y;y++){var R=g[y][0]-1,V=g[y][1]-1,O=g[y][2]-1,w=!1;w||(Array.prototype.push.apply(r,e.vertices[R]),Array.prototype.push.apply(s,e.normals[O]),m?(Array.prototype.push.apply(o,e.uvs[V]),Array.prototype.push.apply(n,[.5,.5,.5,2])):(Array.prototype.push.apply(n,f),Array.prototype.push.apply(o,e.uvs[V])),a.push(x),h.push(u++))}}var M=new VROne.Object3D;if(r.length>0&&(M.vertices=r),n.length>0&&(M.colors=n),o.length>0&&(M.textureCoords=o),d&&(M.textureIndices=a),s.length>0&&(M.normals=s),h.length>0&&(M.indices=h),c){for(var p=0;p<l.length;p++)l[p]=i+l[p].replace(/\\/g,"/");if(l&&l.length>10)throw"OBJ Loader: Can't use more than 10 Textures";l.length>0&&(M.imageSrc=l)}return M},copyOBJO3D:function(e){var t=new VROne.Object3D;return e.vertices&&(t.vertices=e.vertices.slice()),e.colors&&(t.colors=e.colors.slice()),e.textureCoords&&(t.textureCoords=e.textureCoords.slice()),e.textureIndices&&(t.textureIndices=e.textureIndices.slice()),e.normals&&(t.normals=e.normals.slice()),e.indices&&(t.indices=e.indices.slice()),t.imageSrc=e.imageSrc,t}},VROne.VRSquare=function(){VROne.Object3D.call(this),this.shader="vr-canvas",this.vertices=[-1,-1,1,1,-1,1,-1,1,1,1,1,1],this.textureCoords=[0,0,1,0,0,1,1,1]},VROne.VRSquare.prototype=new VROne.Object3D,VROne.ParticleSystem=function(e,t,i,r){VROne.Object3D.call(this);var n=3,o=3,a=3,s=1,h=1,l=1;this.particles=[];var u;for(u=0;i>u;u++)this.particles.push(new VROne.Particle);this.vertices=[],this.colors=null,this.textureCoords=null,this.indices=[],this.velocities=[],this.lifetimes=[],this.gravities=[],this.gravityExps=[],this.geometries=[],this.rotationAngles=[],this.normals=null,this.imageSrc=t.imageSrc,this.shader=null;var c={time:0,startTime:Date.now()};this.shaderAttributes=[],this.shaderAttributes.push(["aGeometryPosition",n,this.geometries]),this.shaderAttributes.push(["aVertexVelocity",o,this.velocities]),this.shaderAttributes.push(["aVertexRotation",a,this.rotationAngles]),this.shaderAttributes.push(["aLifetime",s,this.lifetimes]),this.shaderAttributes.push(["aGravity",h,this.gravities]),this.shaderAttributes.push(["aGravityExponent",l,this.gravityExps]),this.shaderUniforms=[],this.shaderUniforms.push(["uTime","uniform1f",c,["time"]]),this.initParticleArrays=function(){var e;for(u=0;u<this.particles.length;u++){var i=this.particles[u];for(e=0;e<t.vertices.length;e+=3)this.vertices.push(t.vertices[e]*i.scale.x+i.position.x),this.vertices.push(t.vertices[e+1]*i.scale.y+i.position.y),this.vertices.push(t.vertices[e+2]*i.scale.z+i.position.z),this.geometries.push(t.vertices[e]*i.scale.x),this.geometries.push(t.vertices[e+1]*i.scale.y),this.geometries.push(t.vertices[e+2]*i.scale.z)}if(t.textureCoords&&-1!=t.textureCoords[0])for(this.textureCoords=[],u=0;u<this.particles.length;u++)this.textureCoords=this.textureCoords.concat(t.textureCoords);else for(this.colors=[],u=0;u<this.particles.length;u++)this.colors=this.colors.concat(this.particles[u].colors?this.particles[u].colors:t.colors);for(u=0;u<this.particles.length;u++)for(e=0;e<t.indices.length;e++)this.indices.push(t.indices[e]+u*t.vertices.length/n);for(u=0;u<this.particles.length;u++)for(e=0;e<t.vertices.length/n;e++)t.velocities?(this.velocities.push(this.particles[u].velocity.x+t.velocities[e*o]),this.velocities.push(this.particles[u].velocity.y+t.velocities[e*o+1]),this.velocities.push(this.particles[u].velocity.z+t.velocities[e*o+2])):(this.velocities.push(this.particles[u].velocity.x),this.velocities.push(this.particles[u].velocity.y),this.velocities.push(this.particles[u].velocity.z));for(u=0;u<this.particles.length;u++)for(e=0;e<t.vertices.length/n;e++)this.lifetimes.push(t.lifetimes?0===t.lifetimes[e]?this.particles[u].lifetime:Math.min(this.particles[u].lifetime,t.lifetimes[e]):this.particles[u].lifetime);for(u=0;u<this.particles.length;u++)for(e=0;e<t.vertices.length/n;e++)this.gravities.push(t.gravities?this.particles[u].gravity+t.gravities[e]:this.particles[u].gravity),this.gravityExps.push(this.particles[u].gravityExponent);for(u=0;u<this.particles.length;u++)for(e=0;e<t.vertices.length/n;e++)this.rotationAngles.push(this.particles[u].rotationAngle.x),this.rotationAngles.push(this.particles[u].rotationAngle.y),this.rotationAngles.push(this.particles[u].rotationAngle.z);if(t.normals)for(this.normals=[],u=0;u<this.particles.length;u++)this.normals=this.normals.concat(t.normals)};var d=this.update;this.update=function(){d.call(this),c.time=Date.now()+r-c.startTime}},VROne.ParticleSystem.prototype=new VROne.Object3D,VROne.Particle=function(){this.position=new VROne.Vector3(0,0,0),this.rotationAngle=new VROne.Vector3(0,0,0),this.scale=new VROne.Vector3(1,1,1),this.vertices=[],this.colors=null,this.velocity=new VROne.Vector3(0,0,0),this.lifetime=0,this.gravity=0,this.gravityExponent=1},VROne.Skybox=function(e,t,i,r,n,o,a,s,h){VROne.CubeTexture3D.call(this),this.isSkybox=!0,this.imageSrc=[a+e,a+t,a+i,a+r,a+n,a+o],this.parent=s,this.parentRotationWeight=new VROne.Vector3(0,0,0),this.parentPositionWeight=new VROne.Vector3(1,1,1);var l=2*h/Math.sqrt(3);this.scale=new VROne.Vector3(l,l,l),this.textureCoords=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0],this.textureIndices=[0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5],this.normals=null,this.indices.reverse()},VROne.Skybox.prototype=new VROne.Object3D,VROne.Cube3D=function(){VROne.Object3D.call(this),this.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],this.colors=[1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,.5,.5,1,1,.5,.5,1,1,.5,.5,1,1,.5,.5,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1],this.indices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},VROne.Cube3D.prototype=new VROne.Object3D,VROne.CubeTexture3D=function(){VROne.Object3D.call(this),this.imageSrc="nehe.gif",this.vertices=[-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5],this.textureCoords=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],this.indices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],this.calcBoundingBox()},VROne.CubeTexture3D.prototype=VROne.Object3D.prototype,VROne.CubeTexture3D_2=function(){VROne.CubeTexture3D.call(this),this.imageSrc="textures/head.gif",this.textureCoords=[1,0,1,.5,.5,.5,.5,0,0,.5,0,1,.5,1,.5,.5,.5,.5,.5,0,0,0,0,.5,1,0,1,.5,.5,.5,.5,0,.5,.5,.5,1,1,1,1,.5,1,.5,1,1,.5,1,.5,.5],this.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]},VROne.CubeTexture3D_2.prototype=VROne.CubeTexture3D.prototype,VROne.CubeTexture3D_3=function(){VROne.CubeTexture3D.call(this),this.imageSrc="textures/transparent.png",this.transparent=!0},VROne.CubeTexture3D_3.prototype=new VROne.CubeTexture3D,VROne.CubeTexture3D_4=function(){VROne.CubeTexture3D_2.call(this),this.shininess=1,this.useFragmentLighting=!0,this.imageSrc="blue.png",this.transparent=!1,this.normalMap="blue-normal.png",this.textureCoords=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]},VROne.CubeTexture3D_4.prototype=new VROne.CubeTexture3D_2,VROne.Pyramid3D=function(){VROne.Object3D.call(this),this.vertices=[0,1,0,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],this.colors=[1,0,0,.5,0,1,0,.5,0,0,1,.5,0,0,1,.5,0,1,0,.5],this.indices=[0,2,1,0,3,2,0,4,3,0,1,4,1,2,3,1,3,4],this.transparent=!0},VROne.Pyramid3D.prototype=VROne.Object3D.prototype,VROne.Sphere3D=function(){VROne.Object3D.call(this),this.imageSrc="earth.jpg",this.specularMap="earth-specular.gif",this.shininess=10,this.useFragmentLighting=!0;var e=30,t=30,i=5;this.vertices=[],this.normals=[],this.textureCoords=[];for(var r=0;e>=r;r++)for(var n=r*Math.PI/e,o=Math.sin(n),a=Math.cos(n),s=0;t>=s;s++){var h=2*s*Math.PI/t,l=Math.sin(h),u=Math.cos(h),c=u*o,d=a,p=l*o,f=1-s/t,g=1-r/e;this.normals.push(c),this.normals.push(d),this.normals.push(p),this.textureCoords.push(f),this.textureCoords.push(g),this.vertices.push(i*c),this.vertices.push(i*d),this.vertices.push(i*p)}for(console.log(this.normals),this.indices=[],r=0;e>r;r++)for(var s=0;t>s;s++){var x=r*(t+1)+s,m=x+t+1;this.indices.push(x+1),this.indices.push(m),this.indices.push(x),this.indices.push(x+1),this.indices.push(m+1),this.indices.push(m)}},VROne.Sphere3D.prototype=VROne.Object3D.prototype,VROne.Square=function(){VROne.Object3D.call(this),this.vertices=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],this.colors=[0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1],this.indices=[0,1,2,0,2,3]},VROne.Square.prototype=VROne.Object3D.prototype,VROne.KeyboardHandler=function(){var e=[],t=[];VROne.KeyboardHandler.keys=[],this.update=function(){var i;for(i=0;i<e.length;i++)VROne.KeyboardHandler.keys[e[i]]=!0,e.splice(i,1);for(i=0;i<t.length;i++)VROne.KeyboardHandler.keys[t[i]]=!1,t.splice(i,1)},window.addEventListener("keydown",function(t){var i=t.keyCode||t.which;VROne.KeyboardHandler.keys[i]||e.push(i)},!0),window.addEventListener("keyup",function(e){var i=e.keyCode||e.which;t.push(i)},!0)},VROne.KeyboardHandler.isKeyDown=function(e){if(!VROne.KeyboardHandler.keys)return void console.log("KeyboardHandler not initialised");if(1===e.length){var t=e.charCodeAt(0);return VROne.KeyboardHandler.keys[t]}return e.length>1?!1:!1},VROne.KeyboardHandler.prototype={},VROne.GamepadHandler=function(){},VROne.GamepadHandler.getGamepads=function(){return APISupported?navigator.getGamepads():void 0};var APISupported=null,init=function(){navigator.getGamepads?(APISupported=!0,console.log("Gamepad API supported"),console.log("ongamepadconnected"in window?"ongamepadconnected supported":"ongamepadconnected not supported")):(APISupported=!1,console.log("Gamepad API not supported"))};init(),VROne.MouseHandler=function(){function e(){document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement?document.addEventListener("mousemove",t.onMouseLockMove,!1):document.removeEventListener("mousemove",t.onMouseLockMove,!1)}var t=this;this.addedMovement=new VROne.Vector2(0,0),this.movement=new VROne.Vector2(0,0),this.onMouseLockMove=function(e){t.addedMovement.x+=e.movementX||e.mozMovementX||0,t.movement.x=e.movementX||e.mozMovementX||0,t.addedMovement.y+=e.movementY||e.mozMovementY||0,t.movement.y=e.movementY||e.mozMovementY||0},document.addEventListener("pointerlockchange",e,!1),document.addEventListener("mozpointerlockchange",e,!1),document.addEventListener("webkitpointerlockchange",e,!1)};var mouseHandler=null,lastMovement=new VROne.Vector2(0,0),movement=new VROne.Vector2(0,0),x=0,y=0,newFrame=!0;VROne.MouseHandler.getMovement=function(){return null===mouseHandler&&(mouseHandler=new VROne.MouseHandler),newFrame&&(lastMovement.x-mouseHandler.addedMovement.x===0?movement.x=0:(lastMovement.x=mouseHandler.addedMovement.x,movement.x=mouseHandler.movement.x),lastMovement.y-mouseHandler.addedMovement.y===0?movement.y=0:(lastMovement.y=mouseHandler.addedMovement.y,movement.y=mouseHandler.movement.y),newFrame=!1),movement},VROne.MouseHandler.setNewFrameTrue=function(){newFrame=!0},VROne.SensorsHandler=function(){var e=this;this.alpha=0,this.beta=0,this.gamma=0,window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",function(t){e.alpha=t.alpha,e.beta=t.beta,e.gamma=t.gamma},!0)};var sensorsHandler=null;VROne.SensorsHandler.getRoll=function(){return null==sensorsHandler&&(sensorsHandler=new VROne.SensorsHandler),sensorsHandler.alpha},VROne.SensorsHandler.getPitch=function(){return null==sensorsHandler&&(sensorsHandler=new VROne.SensorsHandler),sensorsHandler.beta},VROne.SensorsHandler.getYaw=function(){return null==sensorsHandler&&(sensorsHandler=new VROne.SensorsHandler),sensorsHandler.gamma},VROne.SensorsHandler.prototype={},VROne.HMDHandler=function(){};var vrDevice=null,eyeParamsL=null,eyeParamsR=null,positionDevice=null,foundHMD=!1;VROne.HMDHandler.getHMDData=function(){return eyeParamsL&&eyeParamsR?[eyeParamsL,eyeParamsR]:null},VROne.HMDHandler.getPositionalData=function(){return null!==positionDevice?positionDevice.getState():void 0},VROne.HMDHandler.isPositionDevice=function(){return null===vrDevice&&null!==positionDevice?!0:null!==vrDevice&&null===positionDevice?!1:void 0},VROne.HMDHandler.resetSensor=function(){void 0!==positionDevice&&("resetSensor"in positionDevice?positionDevice.resetSensor():"zeroSensor"in positionDevice?positionDevice.zeroSensor():console.log("Can't reset position sensor."))};var onVRDevices=function(e){for(var t in e)e[t]instanceof HMDVRDevice&&null===vrDevice?(vrDevice=e[t],eyeParamsL=vrDevice.getEyeParameters("left"),eyeParamsR=vrDevice.getEyeParameters("right"),foundHMD=!0):e[t]instanceof PositionSensorVRDevice&&null===positionDevice&&(positionDevice=e[t])};void 0!==navigator.getVRDevices&&navigator.getVRDevices().then(onVRDevices),VROne.HMDHandler.isWebVRReady=function(){return void 0!==navigator.getVRDevices},VROne.HMDHandler.prototype={};